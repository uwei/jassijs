define(["require", "exports", "game/product"], function (require, exports, product_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.Route = void 0;
    class Route {
        constructor() {
            this.type = "Route";
            this.unloadMarketAmount = [];
            this.unloadMarketPrice = [];
            this.unloadWarehouseAmount = [];
            this.loadMarketAmount = [];
            this.loadMarketUntilAmount = [];
            this.loadMarketPrice = [];
            this.loadWarehouseAmount = [];
            this.loadWarehouseUntilAmount = [];
            for (var x = 0; x < product_1.allProducts.length; x++) {
                this.unloadMarketAmount.push(undefined);
                this.unloadMarketPrice.push(product_1.allProducts[x].priceSelling);
                this.unloadWarehouseAmount.push(undefined);
                this.loadMarketAmount.push(undefined);
                this.loadMarketUntilAmount.push(undefined);
                this.loadMarketPrice.push(product_1.allProducts[x].pricePurchase);
                this.loadWarehouseAmount.push(undefined);
                this.loadWarehouseUntilAmount.push(undefined);
            }
        }
        unloadMarket() {
            var city = this.airplane.world.cities[this.cityid];
            for (var x = 0; x < product_1.allProducts.length; x++) {
                var max = this.airplane.products[x];
                if (this.unloadMarketAmount[x] !== undefined) {
                    max = Math.min(this.airplane.products[x], this.unloadMarketAmount[x]);
                    if (max < 0)
                        max = 0;
                }
                if (max) {
                    for (var y = 0; y < max; y++) {
                        var price = product_1.allProducts[x].calcPrice(city.people, city.market[x] + 1, city.isProducedHere(x));
                        if (price >= this.unloadMarketPrice[x]) {
                            city.world.game.money += 1 * price;
                            city.market[x] += 1;
                            this.airplane.products[x] -= 1;
                        }
                        else {
                            break;
                        }
                    }
                }
            }
        }
        loadMarket() {
            var city = this.airplane.world.cities[this.cityid];
            for (var x = 0; x < product_1.allProducts.length; x++) {
                var max = this.loadMarketAmount[x];
                if (this.loadMarketUntilAmount[x] !== undefined) {
                    max = this.loadMarketUntilAmount[x] - this.airplane.products[x];
                    if (max < 0)
                        max = 0;
                }
                if (max) {
                    for (var y = 0; y < max; y++) {
                        var price = product_1.allProducts[x].calcPrice(city.people, city.market[x] - 1, city.isProducedHere(x));
                        if (price <= this.loadMarketPrice[x]) {
                            city.world.game.money += -1 * price;
                            city.market[x] -= 1;
                            this.airplane.products[x] += 1;
                        }
                        else {
                            break;
                        }
                    }
                }
            }
        }
        load() {
            this.loadMarket();
        }
        unload() {
            this.unloadMarket();
        }
    }
    exports.Route = Route;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91dGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9nYW1lL3JvdXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7SUFHQSxNQUFhLEtBQUs7UUFZZDtZQURBLFNBQUksR0FBRyxPQUFPLENBQUM7WUFFWCxJQUFJLENBQUMsa0JBQWtCLEdBQUcsRUFBRSxDQUFDO1lBQzdCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxFQUFFLENBQUM7WUFDNUIsSUFBSSxDQUFDLHFCQUFxQixHQUFHLEVBQUUsQ0FBQztZQUNoQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxxQkFBcUIsR0FBRyxFQUFFLENBQUM7WUFDaEMsSUFBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7WUFDMUIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLEVBQUUsQ0FBQztZQUM5QixJQUFJLENBQUMsd0JBQXdCLEdBQUcsRUFBRSxDQUFDO1lBQ25DLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxxQkFBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDekMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDeEMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxxQkFBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUN6RCxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUMzQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUN0QyxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUMzQyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxxQkFBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLGFB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QUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDOUYsSUFBSSxLQUFLLElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsRUFBRTs0QkFDbEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQzs0QkFDcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7NEJBQ3BCLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQzt5QkFDbEM7NkJBQU07NEJBQ0gsTUFBTTt5QkFFVDtxQkFDSjtpQkFFSjthQUNKO1FBQ0wsQ0FBQztRQUNELElBQUk7WUFFQSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDdEIsQ0FBQztRQUNELE1BQU07WUFFRixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDeEIsQ0FBQztLQUNKO0lBM0ZELHNCQTJGQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFpcnBsYW5lIH0gZnJvbSBcImdhbWUvYWlycGxhbmVcIjtcbmltcG9ydCB7IGFsbFByb2R1Y3RzIH0gZnJvbSBcImdhbWUvcHJvZHVjdFwiO1xuXG5leHBvcnQgY2xhc3MgUm91dGUge1xuICAgIGNpdHlpZDogbnVtYmVyO1xuICAgIHVubG9hZE1hcmtldEFtb3VudDogbnVtYmVyW107XG4gICAgdW5sb2FkTWFya2V0UHJpY2U6IG51bWJlcltdO1xuICAgIHVubG9hZFdhcmVob3VzZUFtb3VudDogbnVtYmVyW107XG4gICAgbG9hZE1hcmtldEFtb3VudDogbnVtYmVyW107XG4gICAgbG9hZE1hcmtldFVudGlsQW1vdW50OiBudW1iZXJbXTtcbiAgICBsb2FkTWFya2V0UHJpY2U6IG51bWJlcltdO1xuICAgIGxvYWRXYXJlaG91c2VBbW91bnQ6IG51bWJlcltdO1xuICAgIGxvYWRXYXJlaG91c2VVbnRpbEFtb3VudDogbnVtYmVyW107XG4gICAgYWlycGxhbmU6IEFpcnBsYW5lO1xuICAgIHR5cGUgPSBcIlJvdXRlXCI7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudW5sb2FkTWFya2V0QW1vdW50ID0gW107XG4gICAgICAgIHRoaXMudW5sb2FkTWFya2V0UHJpY2UgPSBbXTtcbiAgICAgICAgdGhpcy51bmxvYWRXYXJlaG91c2VBbW91bnQgPSBbXTtcbiAgICAgICAgdGhpcy5sb2FkTWFya2V0QW1vdW50ID0gW107XG4gICAgICAgIHRoaXMubG9hZE1hcmtldFVudGlsQW1vdW50ID0gW107XG4gICAgICAgIHRoaXMubG9hZE1hcmtldFByaWNlID0gW107XG4gICAgICAgIHRoaXMubG9hZFdhcmVob3VzZUFtb3VudCA9IFtdO1xuICAgICAgICB0aGlzLmxvYWRXYXJlaG91c2VVbnRpbEFtb3VudCA9IFtdO1xuICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IGFsbFByb2R1Y3RzLmxlbmd0aDsgeCsrKSB7XG4gICAgICAgICAgICB0aGlzLnVubG9hZE1hcmtldEFtb3VudC5wdXNoKHVuZGVmaW5lZCk7XG4gICAgICAgICAgICB0aGlzLnVubG9hZE1hcmtldFByaWNlLnB1c2goYWxsUHJvZHVjdHNbeF0ucHJpY2VTZWxsaW5nKTtcbiAgICAgICAgICAgIHRoaXMudW5sb2FkV2FyZWhvdXNlQW1vdW50LnB1c2godW5kZWZpbmVkKTtcbiAgICAgICAgICAgIHRoaXMubG9hZE1hcmtldEFtb3VudC5wdXNoKHVuZGVmaW5lZCk7XG4gICAgICAgICAgICB0aGlzLmxvYWRNYXJrZXRVbnRpbEFtb3VudC5wdXNoKHVuZGVmaW5lZCk7XG4gICAgICAgICAgICB0aGlzLmxvYWRNYXJrZXRQcmljZS5wdXNoKGFsbFByb2R1Y3RzW3hdLnByaWNlUHVyY2hhc2UpO1xuICAgICAgICAgICAgdGhpcy5sb2FkV2FyZWhvdXNlQW1vdW50LnB1c2godW5kZWZpbmVkKTtcbiAgICAgICAgICAgIHRoaXMubG9hZFdhcmVob3VzZVVudGlsQW1vdW50LnB1c2godW5kZWZpbmVkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1bmxvYWRNYXJrZXQoKSB7XG4gICAgICAgIHZhciBjaXR5ID0gdGhpcy5haXJwbGFuZS53b3JsZC5jaXRpZXNbdGhpcy5jaXR5aWRdO1xuICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IGFsbFByb2R1Y3RzLmxlbmd0aDsgeCsrKSB7XG4gICAgICAgICAgICB2YXIgbWF4ID0gdGhpcy5haXJwbGFuZS5wcm9kdWN0c1t4XTtcblxuICAgICAgICAgICAgaWYgKHRoaXMudW5sb2FkTWFya2V0QW1vdW50W3hdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBtYXg9TWF0aC5taW4odGhpcy5haXJwbGFuZS5wcm9kdWN0c1t4XSx0aGlzLnVubG9hZE1hcmtldEFtb3VudFt4XSk7XG4gICAgICAgICAgICAgICAgaWYobWF4PDApXG4gICAgICAgICAgICAgICAgICAgIG1heD0wO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYobWF4KXtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG1heDsgeSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwcmljZSA9IGFsbFByb2R1Y3RzW3hdLmNhbGNQcmljZShjaXR5LnBlb3BsZSwgY2l0eS5tYXJrZXRbeF0gKyAxLCBjaXR5LmlzUHJvZHVjZWRIZXJlKHgpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByaWNlID49IHRoaXMudW5sb2FkTWFya2V0UHJpY2VbeF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNpdHkud29ybGQuZ2FtZS5tb25leSArPSAxICogcHJpY2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaXR5Lm1hcmtldFt4XSArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5haXJwbGFuZS5wcm9kdWN0c1t4XSAtPSAxO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGxvYWRNYXJrZXQoKSB7XG4gICAgICAgIHZhciBjaXR5ID0gdGhpcy5haXJwbGFuZS53b3JsZC5jaXRpZXNbdGhpcy5jaXR5aWRdO1xuICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IGFsbFByb2R1Y3RzLmxlbmd0aDsgeCsrKSB7XG4gICAgICAgICAgICB2YXIgbWF4ID0gdGhpcy5sb2FkTWFya2V0QW1vdW50W3hdO1xuICAgICAgICAgICAgaWYgKHRoaXMubG9hZE1hcmtldFVudGlsQW1vdW50W3hdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBtYXg9dGhpcy5sb2FkTWFya2V0VW50aWxBbW91bnRbeF0tdGhpcy5haXJwbGFuZS5wcm9kdWN0c1t4XTtcbiAgICAgICAgICAgICAgICBpZihtYXg8MClcbiAgICAgICAgICAgICAgICAgICAgbWF4PTA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihtYXgpe1xuICAgICAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbWF4OyB5KyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByaWNlID0gYWxsUHJvZHVjdHNbeF0uY2FsY1ByaWNlKGNpdHkucGVvcGxlLCBjaXR5Lm1hcmtldFt4XSAtIDEsIGNpdHkuaXNQcm9kdWNlZEhlcmUoeCkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocHJpY2UgPD0gdGhpcy5sb2FkTWFya2V0UHJpY2VbeF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNpdHkud29ybGQuZ2FtZS5tb25leSArPSAtMSAqIHByaWNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2l0eS5tYXJrZXRbeF0gLT0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWlycGxhbmUucHJvZHVjdHNbeF0gKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBsb2FkKCkge1xuXG4gICAgICAgIHRoaXMubG9hZE1hcmtldCgpO1xuICAgIH1cbiAgICB1bmxvYWQoKSB7XG5cbiAgICAgICAgdGhpcy51bmxvYWRNYXJrZXQoKTtcbiAgICB9XG59Il19