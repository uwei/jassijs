define(["require", "exports", "game/product", "game/airplanedialog"], function (require, exports, product_1, airplanedialog_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.Airplane = void 0;
    function getRandomInt(max) {
        return Math.floor(Math.random() * max);
    }
    class Airplane {
        constructor(world) {
            this.status = "";
            this.world = world;
        }
        create() {
            var _this = this;
            this.dom = document.createRange().createContextualFragment("<span style='transform:rotate(0turn)' class='mdi mdi-airplane'></span>").children[0]; //document.createElement("span");
            this.dom.style.position = "absolute";
            this.x = getRandomInt(500);
            this.y = getRandomInt(500);
            this.action = "wait";
            this.products = [];
            for (var x = 0; x < product_1.allProducts.length; x++) {
                this.products[x] = 0;
            }
            this.dom.addEventListener("click", (ev) => {
                _this.onclick(ev);
                return undefined;
            });
            this.lastUpdate = this.world.game.date.getTime();
            this.update();
        }
        flyTo(x, y) {
            this.lastUpdate = this.world.game.date.getTime();
            console.log("fly to " + x + ":" + y);
            this.action = "fly";
            this.targetX = x;
            this.targetY = y;
            this.update();
            for (var i = 0; i < this.world.cities.length; i++) {
                var pos = this.world.cities[i].airplanesInCity.indexOf(this);
                if (pos !== -1) {
                    this.world.cities[i].airplanesInCity.splice(pos, 1);
                }
            }
        }
        select() {
            this.dom.style.color = "red";
        }
        unselect() {
            this.dom.style.color = "black";
        }
        calcNewPosition() {
            var _a;
            var pixelToTarget = Math.round(Math.sqrt(Math.pow(this.targetX - this.x, 2) + Math.pow(this.targetY - this.y, 2))); //Pytharoras
            var fromX = this.x;
            var fromY = this.y;
            var fromTime = 0;
            var toX = this.targetX;
            var toY = this.targetY;
            var toTime = pixelToTarget / this.speed; //t=s/v; in Tage
            var speedVectorX = toX - fromX;
            var speedVectorY = toY - fromY;
            var speedVectorTime = (toTime - fromTime);
            var nowTime = (this.world.game.date.getTime() - this.lastUpdate) / (1000 * 60 * 60 * 24);
            var nowX = Math.round((nowTime / speedVectorTime) * speedVectorX + fromX);
            var nowY = Math.round((nowTime / speedVectorTime) * speedVectorY + fromY);
            if (nowTime >= toTime) {
                this.x = this.targetX;
                this.y = this.targetY;
                console.log("target arrived");
                this.targetX = undefined;
                this.targetY = undefined;
                this.action = "wait";
                this.status = "";
                (_a = this.world.findCityAt(this.x, this.y)) === null || _a === void 0 ? void 0 : _a.airplanesInCity.push(this);
                this.dom.style.transform = "rotate(0deg)";
            }
            else {
                var rad = Math.atan((fromX - toX) / (fromY - toY));
                var winkel = 0;
                if (fromY > toY) {
                    winkel = 360 - rad * (180) / Math.PI;
                }
                else {
                    winkel = 180 - rad * (180) / Math.PI;
                }
                var s = ("" + winkel).replace(",", ".");
                this.dom.style.transform = "rotate(" + s + "deg)";
                // console.log(pixelToTarget+" pixel in "+toTime+" seconds. Position "+nowX+" "+nowY+" lastupdate "+nowTime+" "+winkel+"Â°");
                this.x = nowX;
                this.y = nowY;
            }
        }
        update() {
            if (this.targetX !== undefined) {
                this.calcNewPosition();
            }
            this.lastUpdate = this.world.game.date.getTime();
            this.dom.style.top = this.y + "px";
            this.dom.style.left = this.x + "px";
        }
        onclick(th) {
            var _a;
            th.stopPropagation();
            console.log(this.name);
            (_a = this.world.selection) === null || _a === void 0 ? void 0 : _a.unselect();
            this.world.selection = this;
            this.select();
            var h = airplanedialog_1.AirplaneDialog.getInstance();
            h.airplane = this;
            h.show();
        }
    }
    exports.Airplane = Airplane;
});
//<span style='font-size:100px;'>&#9951;</span>
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWlycGxhbmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9nYW1lL2FpcnBsYW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7SUFJQSxTQUFTLFlBQVksQ0FBQyxHQUFHO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUVELE1BQWEsUUFBUTtRQWNqQixZQUFZLEtBQVc7WUFEdkIsV0FBTSxHQUFRLEVBQUUsQ0FBQztZQUViLElBQUksQ0FBQyxLQUFLLEdBQUMsS0FBSyxDQUFDO1FBQ3JCLENBQUM7UUFDRCxNQUFNO1lBQ0YsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQ2pCLElBQUksQ0FBQyxHQUFHLEdBQVEsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDLHdCQUF3QixDQUFDLHdFQUF3RSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUEsaUNBQWlDO1lBQ3ZMLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxVQUFVLENBQUM7WUFDckMsSUFBSSxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDM0IsSUFBSSxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDM0IsSUFBSSxDQUFDLE1BQU0sR0FBQyxNQUFNLENBQUM7WUFDbkIsSUFBSSxDQUFDLFFBQVEsR0FBQyxFQUFFLENBQUM7WUFDakIsS0FBSSxJQUFJLENBQUMsR0FBQyxDQUFDLEVBQUMsQ0FBQyxHQUFDLHFCQUFXLENBQUMsTUFBTSxFQUFDLENBQUMsRUFBRSxFQUFDO2dCQUNqQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQzthQUV0QjtZQUNELElBQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFF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Q0FBQyxLQUFLLENBQUMsU0FBUywwQ0FBRSxRQUFRLEVBQUUsQ0FBQztZQUNqQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7WUFDNUIsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2QsSUFBSSxDQUFDLEdBQUcsK0JBQWMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNyQyxDQUFDLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztZQUNsQixDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFHYixDQUFDO0tBQ0o7SUF2SEQsNEJBdUhDOztBQUVELCtDQUErQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFdvcmxkIH0gZnJvbSBcImdhbWUvd29ybGRcIjtcbmltcG9ydCB7IGFsbFByb2R1Y3RzIH0gZnJvbSBcImdhbWUvcHJvZHVjdFwiO1xuaW1wb3J0IHsgQWlycGxhbmVEaWFsb2cgfSBmcm9tIFwiZ2FtZS9haXJwbGFuZWRpYWxvZ1wiO1xuXG5mdW5jdGlvbiBnZXRSYW5kb21JbnQobWF4KSB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heCk7XG59XG5cbmV4cG9ydCBjbGFzcyBBaXJwbGFuZSB7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGFjdGlvbjpzdHJpbmc7XG4gICAgeDogbnVtYmVyO1xuICAgIHk6IG51bWJlcjtcbiAgICAvL3BpeGVsIHBybyBzZWNvbmRcbiAgICBzcGVlZDogbnVtYmVyO1xuICAgIGxhc3RVcGRhdGU6IG51bWJlcjtcbiAgICB0YXJnZXRYOiBudW1iZXI7XG4gICAgdGFyZ2V0WTogbnVtYmVyO1xuICAgIGRvbTogSFRNTFNwYW5FbGVtZW50O1xuICAgIHdvcmxkOiBXb3JsZDtcbiAgICBwcm9kdWN0cztcbiAgICBzdGF0dXM6c3RyaW5nPVwiXCI7XG4gICAgY29uc3RydWN0b3Iod29ybGQ6V29ybGQpe1xuICAgICAgICB0aGlzLndvcmxkPXdvcmxkO1xuICAgIH1cbiAgICBjcmVhdGUoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZG9tID0gPGFueT5kb2N1bWVudC5jcmVhdGVSYW5nZSgpLmNyZWF0ZUNvbnRleHR1YWxGcmFnbWVudChcIjxzcGFuIHN0eWxlPSd0cmFuc2Zvcm06cm90YXRlKDB0dXJuKScgY2xhc3M9J21kaSBtZGktYWlycGxhbmUnPjwvc3Bhbj5cIikuY2hpbGRyZW5bMF07Ly9kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgICAgdGhpcy5kb20uc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgICAgIHRoaXMueCA9IGdldFJhbmRvbUludCg1MDApO1xuICAgICAgICB0aGlzLnkgPSBnZXRSYW5kb21JbnQoNTAwKTtcbiAgICAgICAgdGhpcy5hY3Rpb249XCJ3YWl0XCI7XG4gICAgICAgIHRoaXMucHJvZHVjdHM9W107XG4gICAgICAgIGZvcih2YXIgeD0wO3g8YWxsUHJvZHVjdHMubGVuZ3RoO3grKyl7XG4gICAgICAgICAgICB0aGlzLnByb2R1Y3RzW3hdPTA7XG5cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRvbS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICBfdGhpcy5vbmNsaWNrKGV2KTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxhc3RVcGRhdGU9dGhpcy53b3JsZC5nYW1lLmRhdGUuZ2V0VGltZSgpO1xuICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuXG4gICAgfVxuICAgIFxuICAgIGZseVRvKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMubGFzdFVwZGF0ZT10aGlzLndvcmxkLmdhbWUuZGF0ZS5nZXRUaW1lKCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZmx5IHRvIFwiK3grXCI6XCIreSlcbiAgICAgICAgdGhpcy5hY3Rpb249XCJmbHlcIjtcbiAgICAgICAgdGhpcy50YXJnZXRYID0geDtcbiAgICAgICAgdGhpcy50YXJnZXRZID0geTtcbiAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgZm9yKHZhciBpPTA7aTx0aGlzLndvcmxkLmNpdGllcy5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIHZhciBwb3M9dGhpcy53b3JsZC5jaXRpZXNbaV0uYWlycGxhbmVzSW5DaXR5LmluZGV4T2YodGhpcyk7XG4gICAgICAgICAgICBpZihwb3MhPT0tMSl7XG4gICAgICAgICAgICAgICAgdGhpcy53b3JsZC5jaXRpZXNbaV0uYWlycGxhbmVzSW5DaXR5LnNwbGljZShwb3MsMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2VsZWN0KCkge1xuICAgICAgICB0aGlzLmRvbS5zdHlsZS5jb2xvciA9IFwicmVkXCI7XG4gICAgfVxuICAgIHVuc2VsZWN0KCkge1xuICAgICAgICB0aGlzLmRvbS5zdHlsZS5jb2xvciA9IFwiYmxhY2tcIjtcbiAgICB9XG4gY2FsY05ld1Bvc2l0aW9uKCl7XG4gICAgICAgIHZhciBwaXhlbFRvVGFyZ2V0PU1hdGgucm91bmQoIE1hdGguc3FydChNYXRoLnBvdyh0aGlzLnRhcmdldFgtdGhpcy54LDIpK01hdGgucG93KHRoaXMudGFyZ2V0WS10aGlzLnksMikpKTsvL1B5dGhhcm9yYXNcbiAgICAgICAgdmFyIGZyb21YPXRoaXMueDtcbiAgICAgICAgdmFyIGZyb21ZPXRoaXMueTtcbiAgICAgICAgdmFyIGZyb21UaW1lPTA7XG4gICAgICAgIHZhciB0b1g9dGhpcy50YXJnZXRYO1xuICAgICAgICB2YXIgdG9ZPXRoaXMudGFyZ2V0WTtcbiAgICAgICAgdmFyIHRvVGltZT1waXhlbFRvVGFyZ2V0L3RoaXMuc3BlZWQ7ICAgIC8vdD1zL3Y7IGluIFRhZ2VcbiAgICAgICAgdmFyIHNwZWVkVmVjdG9yWD10b1gtZnJvbVg7XG4gICAgICAgIHZhciBzcGVlZFZlY3Rvclk9dG9ZLWZyb21ZO1xuICAgICAgICB2YXIgc3BlZWRWZWN0b3JUaW1lPSh0b1RpbWUtZnJvbVRpbWUpO1xuICAgICAgICB2YXIgbm93VGltZT0odGhpcy53b3JsZC5nYW1lLmRhdGUuZ2V0VGltZSgpLXRoaXMubGFzdFVwZGF0ZSkvKDEwMDAqNjAqNjAqMjQpO1xuICAgICAgICB2YXIgbm93WD1NYXRoLnJvdW5kKChub3dUaW1lL3NwZWVkVmVjdG9yVGltZSkqc3BlZWRWZWN0b3JYK2Zyb21YKTtcbiAgICAgICAgdmFyIG5vd1k9TWF0aC5yb3VuZCgobm93VGltZS9zcGVlZFZlY3RvclRpbWUpKnNwZWVkVmVjdG9yWStmcm9tWSk7XG4gICAgICAgIGlmKG5vd1RpbWU+PXRvVGltZSl7XG4gICAgICAgICAgICB0aGlzLng9dGhpcy50YXJnZXRYO1xuICAgICAgICAgICAgdGhpcy55PXRoaXMudGFyZ2V0WTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidGFyZ2V0IGFycml2ZWRcIik7XG4gICAgICAgICAgICB0aGlzLnRhcmdldFg9dW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy50YXJnZXRZPXVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuYWN0aW9uPVwid2FpdFwiO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXM9XCJcIjtcbiAgICAgICAgICAgIHRoaXMud29ybGQuZmluZENpdHlBdCh0aGlzLngsdGhpcy55KT8uYWlycGxhbmVzSW5DaXR5LnB1c2godGhpcyk7XG4gICAgICAgICAgICB0aGlzLmRvbS5zdHlsZS50cmFuc2Zvcm09XCJyb3RhdGUoMGRlZylcIjtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB2YXIgcmFkPU1hdGguYXRhbigoZnJvbVgtdG9YKS8oZnJvbVktdG9ZKSk7XG4gICAgICAgICAgICB2YXIgd2lua2VsPTA7XG4gICAgICAgICAgICBpZihmcm9tWT50b1kpe1xuICAgICAgICAgICAgICAgIHdpbmtlbD0zNjAtcmFkKigxODApL01hdGguUEk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICB3aW5rZWw9MTgwLXJhZCooMTgwKS9NYXRoLlBJO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHM9KFwiXCIrd2lua2VsKS5yZXBsYWNlKFwiLFwiLFwiLlwiKTtcbiAgICAgICAgICAgIHRoaXMuZG9tLnN0eWxlLnRyYW5zZm9ybT1cInJvdGF0ZShcIitzK1wiZGVnKVwiO1xuICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhwaXhlbFRvVGFyZ2V0K1wiIHBpeGVsIGluIFwiK3RvVGltZStcIiBzZWNvbmRzLiBQb3NpdGlvbiBcIitub3dYK1wiIFwiK25vd1krXCIgbGFzdHVwZGF0ZSBcIitub3dUaW1lK1wiIFwiK3dpbmtlbCtcIsKwXCIpO1xuICAgICAgICAgICAgdGhpcy54PW5vd1g7XG4gICAgICAgICAgICB0aGlzLnk9bm93WTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGUoKSB7XG4gICAgICAgXG4gICAgICAgIGlmKHRoaXMudGFyZ2V0WCE9PXVuZGVmaW5lZCl7XG4gICAgICAgICAgICB0aGlzLmNhbGNOZXdQb3NpdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGFzdFVwZGF0ZT10aGlzLndvcmxkLmdhbWUuZGF0ZS5nZXRUaW1lKCk7XG4gICAgICAgdGhpcy5kb20uc3R5bGUudG9wID0gdGhpcy55ICsgXCJweFwiO1xuICAgICAgIHRoaXMuZG9tLnN0eWxlLmxlZnQgPSB0aGlzLnggKyBcInB4XCI7XG5cbiAgICB9XG4gICAgb25jbGljayh0aDogTW91c2VFdmVudCkge1xuICAgICAgICB0aC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5uYW1lKTtcbiAgICAgICAgdGhpcy53b3JsZC5zZWxlY3Rpb24/LnVuc2VsZWN0KCk7XG4gICAgICAgIHRoaXMud29ybGQuc2VsZWN0aW9uID0gdGhpcztcbiAgICAgICAgdGhpcy5zZWxlY3QoKTtcbiAgICAgICAgdmFyIGggPSBBaXJwbGFuZURpYWxvZy5nZXRJbnN0YW5jZSgpO1xuICAgICAgICBoLmFpcnBsYW5lID0gdGhpcztcbiAgICAgICAgaC5zaG93KCk7XG5cbiAgICBcbiAgICB9XG59XG5cbi8vPHNwYW4gc3R5bGU9J2ZvbnQtc2l6ZToxMDBweDsnPiYjOTk1MTs8L3NwYW4+Il19