define(["require", "exports", "game/product", "game/airplanedialog"], function (require, exports, product_1, airplanedialog_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.Airplane = void 0;
    function getRandomInt(max) {
        return Math.floor(Math.random() * max);
    }
    class Airplane {
        constructor(world) {
            this.status = "";
            this.world = world;
        }
        create() {
            var _this = this;
            this.dom = document.createRange().createContextualFragment("<span style='transform:rotate(0turn)' class='mdi mdi-airplane'></span>").children[0]; //document.createElement("span");
            this.dom.style.position = "absolute";
            this.x = getRandomInt(500);
            this.y = getRandomInt(500);
            this.action = "wait";
            this.products = [];
            for (var x = 0; x < product_1.allProducts.length; x++) {
                this.products[x] = 0;
            }
            this.dom.addEventListener("click", (ev) => {
                _this.onclick(ev);
                return undefined;
            });
            this.lastUpdate = this.world.game.date.getTime();
            this.update();
        }
        flyTo(x, y) {
            console.log("fly to " + x + ":" + y);
            this.action = "fly";
            this.targetX = x;
            this.targetY = y;
            this.update();
            for (var i = 0; i < this.world.cities.length; i++) {
                var pos = this.world.cities[i].airplanesInCity.indexOf(this);
                if (pos !== -1) {
                    this.world.cities[i].airplanesInCity.splice(pos, 1);
                }
            }
        }
        select() {
            this.dom.style.color = "red";
        }
        unselect() {
            this.dom.style.color = "black";
        }
        calcNewPosition() {
            var _a;
            var pixelToTarget = Math.round(Math.sqrt(Math.pow(this.targetX - this.x, 2) + Math.pow(this.targetY - this.y, 2))); //Pytharoras
            var fromX = this.x;
            var fromY = this.y;
            var fromTime = 0;
            var toX = this.targetX;
            var toY = this.targetY;
            var toTime = pixelToTarget / this.speed; //t=s/v;
            var speedVectorX = toX - fromX;
            var speedVectorY = toY - fromY;
            var speedVectorTime = (toTime - fromTime) / this.world.game.speed;
            var nowTime = (Date.now() - this.lastUpdate) / 1000;
            var nowX = Math.round((nowTime / speedVectorTime) * speedVectorX + fromX);
            var nowY = Math.round((nowTime / speedVectorTime) * speedVectorY + fromY);
            if (nowTime >= toTime) {
                this.x = this.targetX;
                this.y = this.targetY;
                console.log("target arrived");
                this.targetX = undefined;
                this.targetY = undefined;
                this.action = "wait";
                this.status = "";
                (_a = this.world.findCityAt(this.x, this.y)) === null || _a === void 0 ? void 0 : _a.airplanesInCity.push(this);
                this.dom.style.transform = "rotate(0deg)";
            }
            else {
                var rad = Math.atan((fromX - toX) / (fromY - toY));
                var winkel = 0;
                if (fromY > toY) {
                    winkel = 360 - rad * (180) / Math.PI;
                }
                else {
                    winkel = 180 - rad * (180) / Math.PI;
                }
                var s = ("" + winkel).replace(",", ".");
                this.dom.style.transform = "rotate(" + s + "deg)";
                // console.log(pixelToTarget+" pixel in "+toTime+" seconds. Position "+nowX+" "+nowY+" lastupdate "+nowTime+" "+winkel+"Â°");
                this.x = nowX;
                this.y = nowY;
            }
        }
        update() {
            if (this.lastUpdate === undefined) {
                this.lastUpdate = Date.now();
            }
            if (this.targetX !== undefined) {
                this.calcNewPosition();
            }
            this.lastUpdate = Date.now();
            this.dom.style.top = this.y + "px";
            this.dom.style.left = this.x + "px";
        }
        onclick(th) {
            var _a;
            th.stopPropagation();
            console.log(this.name);
            (_a = this.world.selection) === null || _a === void 0 ? void 0 : _a.unselect();
            this.world.selection = this;
            this.select();
            var h = airplanedialog_1.AirplaneDialog.getInstance();
            h.airplane = this;
            h.show();
        }
    }
    exports.Airplane = Airplane;
});
//<span style='font-size:100px;'>&#9951;</span>
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWlycGxhbmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9nYW1lL2FpcnBsYW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7SUFJQSxTQUFTLFlBQVksQ0FBQyxHQUFHO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUVELE1BQWEsUUFBUTtRQWNqQixZQUFZLEtBQVc7WUFEdkIsV0FBTSxHQUFRLEVBQUUsQ0FBQztZQUViLElBQUksQ0FBQyxLQUFLLEdBQUMsS0FBSyxDQUFDO1FBQ3JCLENBQUM7UUFDRCxNQUFNO1lBQ0YsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQ2pCLElBQUksQ0FBQyxHQUFHLEdBQVEsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDLHdCQUF3QixDQUFDLHdFQUF3RSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUEsaUNBQWlDO1lBQ3ZMLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxVQUFVLENBQUM7WUFDckMsSUFBSSxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDM0IsSUFBSSxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDM0IsSUFBSSxDQUFDLE1BQU0sR0FBQyxNQUFNLENBQUM7WUFDbkIsSUFBSSxDQUFDLFFBQVEsR0FBQyxFQUFFLENBQUM7WUFDakIsS0FBSSxJQUFJLENBQUMsR0FBQyxDQUFDLEVBQUMsQ0FBQyxHQUFDLHFCQUFXLENBQUMsTUFBTSxFQUFDLENBQUMsRUFBRSxFQUFDO2dCQUNqQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFDLENBQUMsQ0FBQzthQUV0QjtZQUNELElBQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFF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QyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7WUFDNUIsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2QsSUFBSSxDQUFDLEdBQUcsK0JBQWMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNyQyxDQUFDLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztZQUNsQixDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFHYixDQUFDO0tBQ0o7SUF4SEQsNEJBd0hDOztBQUVELCtDQUErQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFdvcmxkIH0gZnJvbSBcImdhbWUvd29ybGRcIjtcbmltcG9ydCB7IGFsbFByb2R1Y3RzIH0gZnJvbSBcImdhbWUvcHJvZHVjdFwiO1xuaW1wb3J0IHsgQWlycGxhbmVEaWFsb2cgfSBmcm9tIFwiZ2FtZS9haXJwbGFuZWRpYWxvZ1wiO1xuXG5mdW5jdGlvbiBnZXRSYW5kb21JbnQobWF4KSB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heCk7XG59XG5cbmV4cG9ydCBjbGFzcyBBaXJwbGFuZSB7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGFjdGlvbjpzdHJpbmc7XG4gICAgeDogbnVtYmVyO1xuICAgIHk6IG51bWJlcjtcbiAgICAvL3BpeGVsIHBybyBzZWNvbmRcbiAgICBzcGVlZDogbnVtYmVyO1xuICAgIGxhc3RVcGRhdGU6IG51bWJlcjtcbiAgICB0YXJnZXRYOiBudW1iZXI7XG4gICAgdGFyZ2V0WTogbnVtYmVyO1xuICAgIGRvbTogSFRNTFNwYW5FbGVtZW50O1xuICAgIHdvcmxkOiBXb3JsZDtcbiAgICBwcm9kdWN0cztcbiAgICBzdGF0dXM6c3RyaW5nPVwiXCI7XG4gICAgY29uc3RydWN0b3Iod29ybGQ6V29ybGQpe1xuICAgICAgICB0aGlzLndvcmxkPXdvcmxkO1xuICAgIH1cbiAgICBjcmVhdGUoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZG9tID0gPGFueT5kb2N1bWVudC5jcmVhdGVSYW5nZSgpLmNyZWF0ZUNvbnRleHR1YWxGcmFnbWVudChcIjxzcGFuIHN0eWxlPSd0cmFuc2Zvcm06cm90YXRlKDB0dXJuKScgY2xhc3M9J21kaSBtZGktYWlycGxhbmUnPjwvc3Bhbj5cIikuY2hpbGRyZW5bMF07Ly9kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgICAgdGhpcy5kb20uc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgICAgIHRoaXMueCA9IGdldFJhbmRvbUludCg1MDApO1xuICAgICAgICB0aGlzLnkgPSBnZXRSYW5kb21JbnQoNTAwKTtcbiAgICAgICAgdGhpcy5hY3Rpb249XCJ3YWl0XCI7XG4gICAgICAgIHRoaXMucHJvZHVjdHM9W107XG4gICAgICAgIGZvcih2YXIgeD0wO3g8YWxsUHJvZHVjdHMubGVuZ3RoO3grKyl7XG4gICAgICAgICAgICB0aGlzLnByb2R1Y3RzW3hdPTA7XG5cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRvbS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICBfdGhpcy5vbmNsaWNrKGV2KTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxhc3RVcGRhdGU9dGhpcy53b3JsZC5nYW1lLmRhdGUuZ2V0VGltZSgpO1xuICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuXG4gICAgfVxuICAgIFxuICAgIGZseVRvKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZmx5IHRvIFwiK3grXCI6XCIreSlcbiAgICAgICAgdGhpcy5hY3Rpb249XCJmbHlcIjtcbiAgICAgICAgdGhpcy50YXJnZXRYID0geDtcbiAgICAgICAgdGhpcy50YXJnZXRZID0geTtcbiAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgZm9yKHZhciBpPTA7aTx0aGlzLndvcmxkLmNpdGllcy5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIHZhciBwb3M9dGhpcy53b3JsZC5jaXRpZXNbaV0uYWlycGxhbmVzSW5DaXR5LmluZGV4T2YodGhpcyk7XG4gICAgICAgICAgICBpZihwb3MhPT0tMSl7XG4gICAgICAgICAgICAgICAgdGhpcy53b3JsZC5jaXRpZXNbaV0uYWlycGxhbmVzSW5DaXR5LnNwbGljZShwb3MsMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2VsZWN0KCkge1xuICAgICAgICB0aGlzLmRvbS5zdHlsZS5jb2xvciA9IFwicmVkXCI7XG4gICAgfVxuICAgIHVuc2VsZWN0KCkge1xuICAgICAgICB0aGlzLmRvbS5zdHlsZS5jb2xvciA9IFwiYmxhY2tcIjtcbiAgICB9XG4gY2FsY05ld1Bvc2l0aW9uKCl7XG4gICAgICAgIHZhciBwaXhlbFRvVGFyZ2V0PU1hdGgucm91bmQoIE1hdGguc3FydChNYXRoLnBvdyh0aGlzLnRhcmdldFgtdGhpcy54LDIpK01hdGgucG93KHRoaXMudGFyZ2V0WS10aGlzLnksMikpKTsvL1B5dGhhcm9yYXNcbiAgICAgICAgdmFyIGZyb21YPXRoaXMueDtcbiAgICAgICAgdmFyIGZyb21ZPXRoaXMueTtcbiAgICAgICAgdmFyIGZyb21UaW1lPTA7XG4gICAgICAgIHZhciB0b1g9dGhpcy50YXJnZXRYO1xuICAgICAgICB2YXIgdG9ZPXRoaXMudGFyZ2V0WTtcbiAgICAgICAgdmFyIHRvVGltZT1waXhlbFRvVGFyZ2V0L3RoaXMuc3BlZWQ7ICAgIC8vdD1zL3Y7XG4gICAgICAgIHZhciBzcGVlZFZlY3Rvclg9dG9YLWZyb21YO1xuICAgICAgICB2YXIgc3BlZWRWZWN0b3JZPXRvWS1mcm9tWTtcbiAgICAgICAgdmFyIHNwZWVkVmVjdG9yVGltZT0odG9UaW1lLWZyb21UaW1lKS90aGlzLndvcmxkLmdhbWUuc3BlZWQ7XG4gICAgICAgIHZhciBub3dUaW1lPShEYXRlLm5vdygpLXRoaXMubGFzdFVwZGF0ZSkvMTAwMDtcbiAgICAgICAgdmFyIG5vd1g9TWF0aC5yb3VuZCgobm93VGltZS9zcGVlZFZlY3RvclRpbWUpKnNwZWVkVmVjdG9yWCtmcm9tWCk7XG4gICAgICAgIHZhciBub3dZPU1hdGgucm91bmQoKG5vd1RpbWUvc3BlZWRWZWN0b3JUaW1lKSpzcGVlZFZlY3RvclkrZnJvbVkpO1xuICAgICAgICBpZihub3dUaW1lPj10b1RpbWUpe1xuICAgICAgICAgICAgdGhpcy54PXRoaXMudGFyZ2V0WDtcbiAgICAgICAgICAgIHRoaXMueT10aGlzLnRhcmdldFk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInRhcmdldCBhcnJpdmVkXCIpO1xuICAgICAgICAgICAgdGhpcy50YXJnZXRYPXVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0WT11bmRlZmluZWQ7XG4gICAgICAgICAgICB0aGlzLmFjdGlvbj1cIndhaXRcIjtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzPVwiXCI7XG4gICAgICAgICAgICB0aGlzLndvcmxkLmZpbmRDaXR5QXQodGhpcy54LHRoaXMueSk/LmFpcnBsYW5lc0luQ2l0eS5wdXNoKHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5kb20uc3R5bGUudHJhbnNmb3JtPVwicm90YXRlKDBkZWcpXCI7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdmFyIHJhZD1NYXRoLmF0YW4oKGZyb21YLXRvWCkvKGZyb21ZLXRvWSkpO1xuICAgICAgICAgICAgdmFyIHdpbmtlbD0wO1xuICAgICAgICAgICAgaWYoZnJvbVk+dG9ZKXtcbiAgICAgICAgICAgICAgICB3aW5rZWw9MzYwLXJhZCooMTgwKS9NYXRoLlBJO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgd2lua2VsPTE4MC1yYWQqKDE4MCkvTWF0aC5QSTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzPShcIlwiK3dpbmtlbCkucmVwbGFjZShcIixcIixcIi5cIik7XG4gICAgICAgICAgICB0aGlzLmRvbS5zdHlsZS50cmFuc2Zvcm09XCJyb3RhdGUoXCIrcytcImRlZylcIjtcbiAgICAgICAgICAgLy8gY29uc29sZS5sb2cocGl4ZWxUb1RhcmdldCtcIiBwaXhlbCBpbiBcIit0b1RpbWUrXCIgc2Vjb25kcy4gUG9zaXRpb24gXCIrbm93WCtcIiBcIitub3dZK1wiIGxhc3R1cGRhdGUgXCIrbm93VGltZStcIiBcIit3aW5rZWwrXCLCsFwiKTtcbiAgICAgICAgICAgIHRoaXMueD1ub3dYO1xuICAgICAgICAgICAgdGhpcy55PW5vd1k7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXBkYXRlKCkge1xuICAgICAgICBpZih0aGlzLmxhc3RVcGRhdGU9PT11bmRlZmluZWQpe1xuICAgICAgICAgICAgdGhpcy5sYXN0VXBkYXRlPURhdGUubm93KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYodGhpcy50YXJnZXRYIT09dW5kZWZpbmVkKXtcbiAgICAgICAgICAgIHRoaXMuY2FsY05ld1Bvc2l0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYXN0VXBkYXRlPURhdGUubm93KCk7XG4gICAgICAgdGhpcy5kb20uc3R5bGUudG9wID0gdGhpcy55ICsgXCJweFwiO1xuICAgICAgIHRoaXMuZG9tLnN0eWxlLmxlZnQgPSB0aGlzLnggKyBcInB4XCI7XG5cbiAgICB9XG4gICAgb25jbGljayh0aDogTW91c2VFdmVudCkge1xuICAgICAgICB0aC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5uYW1lKTtcbiAgICAgICAgdGhpcy53b3JsZC5zZWxlY3Rpb24/LnVuc2VsZWN0KCk7XG4gICAgICAgIHRoaXMud29ybGQuc2VsZWN0aW9uID0gdGhpcztcbiAgICAgICAgdGhpcy5zZWxlY3QoKTtcbiAgICAgICAgdmFyIGggPSBBaXJwbGFuZURpYWxvZy5nZXRJbnN0YW5jZSgpO1xuICAgICAgICBoLmFpcnBsYW5lID0gdGhpcztcbiAgICAgICAgaC5zaG93KCk7XG5cbiAgICBcbiAgICB9XG59XG5cbi8vPHNwYW4gc3R5bGU9J2ZvbnQtc2l6ZToxMDBweDsnPiYjOTk1MTs8L3NwYW4+Il19