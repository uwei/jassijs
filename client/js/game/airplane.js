define(["require", "exports", "game/product", "game/airplanedialog"], function (require, exports, product_1, airplanedialog_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.allAirplaneTypes = exports.Airplane = void 0;
    function getRandomInt(max) {
        return Math.floor(Math.random() * max);
    }
    //
    class Airplane {
        constructor(world) {
            this.status = "";
            this.costs = 20;
            this.capacity = 200;
            this.activeRoute = 0;
            this.type = "Airplane";
            this.world = world;
            this.route = [];
            /*  for(var x=0;x<4;x++){
                  var rt=new Route();
                  rt.cityid=x;
                  this.route.push(rt);
              }*/
        }
        render() {
            var _this = this;
            this.dom = document.createRange().createContextualFragment("<span style='font-size:20px;transform:rotate(0turn)' class='mdi mdi-airplane'></span>").children[0]; //document.createElement("span");
            this.dom.style.position = "absolute";
            this.action = "wait";
            this.products = [];
            for (var x = 0; x < product_1.allProducts.length; x++) {
                this.products[x] = 0;
            }
            this.dom.addEventListener("click", (ev) => {
                _this.onclick(ev);
                return undefined;
            });
            this.lastUpdate = this.world.game.date.getTime();
            this.update();
        }
        flyTo(city) {
            var x = city.x;
            var y = city.y;
            this.lastUpdate = this.world.game.date.getTime();
            // console.log("fly to " + city.name)
            this.action = "fly";
            this.status = "fly to " + city.name;
            this.targetX = x;
            this.targetY = y;
            this.update();
            for (var i = 0; i < this.world.cities.length; i++) {
                var pos = this.world.cities[i].airplanesInCity.indexOf(this);
                if (pos !== -1) {
                    this.world.cities[i].airplanesInCity.splice(pos, 1);
                }
            }
        }
        select() {
            if (this.dom)
                this.dom.style.color = "red";
        }
        unselect() {
            if (this.dom)
                this.dom.style.color = "black";
        }
        arrived() {
            var _a;
            console.log("target arrived");
            this.targetX = undefined;
            this.targetY = undefined;
            this.action = "wait";
            this.status = "";
            (_a = this.world.findCityAt(this.x, this.y)) === null || _a === void 0 ? void 0 : _a.airplanesInCity.push(this);
            this.dom.style.transform = "rotate(0deg)";
            if (this.activeRoute !== -1) {
                console.log("unload now");
                this.action = "unload";
                this.status = "unload";
                this.lastAction = this.lastUpdate;
            }
        }
        calcNewPosition() {
            var pixelToTarget = Math.round(Math.sqrt(Math.pow(this.targetX - this.x, 2) + Math.pow(this.targetY - this.y, 2))); //Pytharoras
            var fromX = this.x;
            var fromY = this.y;
            var fromTime = 0;
            var toX = this.targetX;
            var toY = this.targetY;
            var toTime = pixelToTarget / this.speed; //t=s/v; in Tage
            var speedVectorX = toX - fromX;
            var speedVectorY = toY - fromY;
            var speedVectorTime = (toTime - fromTime);
            var nowTime = (this.world.game.date.getTime() - this.lastUpdate) / (1000 * 60 * 60 * 24);
            var nowX = Math.round((nowTime / speedVectorTime) * speedVectorX + fromX);
            var nowY = Math.round((nowTime / speedVectorTime) * speedVectorY + fromY);
            if (nowTime >= toTime) {
                this.x = this.targetX;
                this.y = this.targetY;
                this.arrived();
            }
            else {
                var rad = Math.atan((fromX - toX) / (fromY - toY));
                var winkel = 0;
                if (fromY > toY) {
                    winkel = 360 - rad * (180) / Math.PI;
                }
                else {
                    winkel = 180 - rad * (180) / Math.PI;
                }
                var s = ("" + winkel).replace(",", ".");
                this.dom.style.transform = "rotate(" + s + "deg)";
                // console.log(pixelToTarget+" pixel in "+toTime+" seconds. Position "+nowX+" "+nowY+" lastupdate "+nowTime+" "+winkel+"Â°");
                this.x = nowX;
                this.y = nowY;
            }
        }
        update() {
            if (this.targetX !== undefined) {
                this.calcNewPosition();
            }
            this.lastUpdate = this.world.game.date.getTime();
            this.dom.style.top = this.y + "px";
            this.dom.style.left = (this.x - 15) + "px";
            if (this.activeRoute !== -1 && this.route.length > 1) {
                if (this.action === "unload" && (this.lastUpdate - this.lastAction) > (3 * 1000 * 60 * 60)) {
                    // console.log("load now");
                    this.action = "load";
                    this.status = "load";
                    this.lastAction = this.lastUpdate;
                    this.route[this.activeRoute].unload();
                    airplanedialog_1.AirplaneDialog.getInstance().update();
                }
                if (this.action === "load" && (this.lastUpdate - this.lastAction) > (3 * 1000 * 60 * 60)) {
                    this.lastAction = this.lastUpdate;
                    this.route[this.activeRoute].load();
                    airplanedialog_1.AirplaneDialog.getInstance().update();
                    this.activeRoute++;
                    if (this.activeRoute === this.route.length)
                        this.activeRoute = 0;
                    var city = this.world.cities[this.route[this.activeRoute].cityid];
                    this.flyTo(city);
                }
            }
        }
        onclick(th) {
            var _a;
            th.preventDefault();
            th.stopPropagation();
            console.log(this.name);
            (_a = this.world.selection) === null || _a === void 0 ? void 0 : _a.unselect();
            this.world.selection = this;
            this.select();
            var h = airplanedialog_1.AirplaneDialog.getInstance();
            h.airplane = this;
            h.show();
        }
    }
    exports.Airplane = Airplane;
    var allAirplaneTypes = [
        { typeid: 1, model: "Airplane A", speed: 100, capacity: 200, costs: 20, buildDays: 25, buildingCosts: 11000, buildingMaterial: [40, 0, 0, 10, 0, 0, 0, 0, 10, 0, 10, 0, 0, 0, 0, 10] },
        { typeid: 2, model: "Airplane B", speed: 120, capacity: 300, costs: 30, buildDays: 30, buildingCosts: 21000, buildingMaterial: [60, 0, 0, 20, 0, 0, 0, 0, 20, 0, 20, 0, 0, 0, 0, 20] },
        { typeid: 3, model: "Airplane C", speed: 100, capacity: 500, costs: 50, buildDays: 39, buildingCosts: 32000, buildingMaterial: [100, 0, 0, 30, 0, 0, 0, 0, 30, 0, 30, 0, 0, 0, 0, 30] },
        { typeid: 4, model: "Airplane D", speed: 110, capacity: 650, costs: 65, buildDays: 45, buildingCosts: 55000, buildingMaterial: [120, 0, 0, 40, 0, 0, 0, 0, 40, 0, 40, 0, 0, 0, 0, 40] },
        { typeid: 5, model: "Airplane E", speed: 100, capacity: 1000, costs: 100, buildDays: 56, buildingCosts: 109000, buildingMaterial: [200, 0, 0, 50, 0, 0, 0, 0, 50, 0, 50, 0, 0, 0, 0, 50] },
        { typeid: 6, model: "Airplane F", speed: 130, capacity: 2000, costs: 200, buildDays: 79, buildingCosts: 110000, buildingMaterial: [400, 0, 0, 100, 0, 0, 0, 0, 100, 0, 100, 0, 0, 0, 0, 100] }
    ];
    exports.allAirplaneTypes = allAirplaneTypes;
});
//<span style='font-size:100px;'>&#9951;</span>
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWlycGxhbmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9nYW1lL2FpcnBsYW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7SUFNQSxTQUFTLFlBQVksQ0FBQyxHQUFHO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUNELEVBQUU7SUFDRixNQUFhLFFBQVE7UUFzQmpCLFlBQVksS0FBWTtZQU54QixXQUFNLEdBQVcsRUFBRSxDQUFDO1lBRXBCLFVBQUssR0FBQyxFQUFFLENBQUM7WUFDVCxhQUFRLEdBQUMsR0FBRyxDQUFDO1lBQ2IsZ0JBQVcsR0FBRyxDQUFDLENBQUM7WUFDaEIsU0FBSSxHQUFHLFVBQVUsQ0FBQztZQUVkLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1lBQ25CLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1lBQ2hCOzs7O2lCQUlLO1FBQ1QsQ0FBQztRQUNELE1BQU07WUFDRixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUM7WUFDakIsSUFBSSxDQUFDLEdBQUcsR0FBUSxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUMsd0JBQXdCLENBQUMsdUZBQXVGLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQSxpQ0FBaUM7WUFDdE0sSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxHQUFHLFVBQVUsQ0FBQztZQUVyQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztZQUNyQixJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztZQUNuQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcscUJBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQ3pDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcs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QUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsQ0FBQyxFQUFDO1FBQ3hKLEVBQUMsTUFBTSxFQUFDLENBQUMsRUFBQyxLQUFLLEVBQUMsWUFBWSxFQUFDLEtBQUssRUFBQyxHQUFHLEVBQUMsUUFBUSxFQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUMsRUFBRSxFQUFDLFNBQVMsRUFBQyxFQUFFLEVBQUMsYUFBYSxFQUFDLEtBQUssRUFBQyxnQkFBZ0IsRUFBQyxDQUFDLEdBQUcsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsQ0FBQyxFQUFDO1FBQ3hKLEVBQUMsTUFBTSxFQUFDLENBQUMsRUFBQyxLQUFLLEVBQUMsWUFBWSxFQUFDLEtBQUssRUFBQyxHQUFHLEVBQUMsUUFBUSxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsR0FBRyxFQUFDLFNBQVMsRUFBQyxFQUFFLEVBQUMsYUFBYSxFQUFDLE1BQU0sRUFBQyxnQkFBZ0IsRUFBQyxDQUFDLEdBQUcsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsQ0FBQyxFQUFDO1FBQzNKLEVBQUMsTUFBTSxFQUFDLENBQUMsRUFBQyxLQUFLLEVBQUMsWUFBWSxFQUFDLEtBQUssRUFBQyxHQUFHLEVBQUMsUUFBUSxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsR0FBRyxFQUFDLFNBQVMsRUFBQyxFQUFFLEVBQUMsYUFBYSxFQUFDLE1BQU0sRUFBQyxnQkFBZ0IsRUFBQyxDQUFDLEdBQUcsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEdBQUcsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsR0FBRyxFQUFDLENBQUMsRUFBQyxHQUFHLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEdBQUcsQ0FBQyxFQUFDO0tBQzlKLENBQUM7SUFDSyw0Q0FBZ0I7O0FBQ3ZCLCtDQUErQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFdvcmxkIH0gZnJvbSBcImdhbWUvd29ybGRcIjtcbmltcG9ydCB7IGFsbFByb2R1Y3RzIH0gZnJvbSBcImdhbWUvcHJvZHVjdFwiO1xuaW1wb3J0IHsgQWlycGxhbmVEaWFsb2cgfSBmcm9tIFwiZ2FtZS9haXJwbGFuZWRpYWxvZ1wiO1xuaW1wb3J0IHsgUm91dGUgfSBmcm9tIFwiZ2FtZS9yb3V0ZVwiO1xuaW1wb3J0IHsgQ2l0eSB9IGZyb20gXCJnYW1lL2NpdHlcIjtcblxuZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1heCkge1xuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXgpO1xufVxuLy9cbmV4cG9ydCBjbGFzcyBBaXJwbGFuZSB7XG4gICAgdHlwZWlkOm51bWJlcjtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgYWN0aW9uOiBzdHJpbmc7XG4gICAgbGFzdEFjdGlvbjogbnVtYmVyO1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG4gICAgLy9waXhlbCBwcm8gc2Vjb25kXG4gICAgc3BlZWQ6IG51bWJlcjtcbiAgICB0b3RhbFNwZWVkOm51bWJlcjtcbiAgICBsYXN0VXBkYXRlOiBudW1iZXI7XG4gICAgdGFyZ2V0WDogbnVtYmVyO1xuICAgIHRhcmdldFk6IG51bWJlcjtcbiAgICBkb206IEhUTUxTcGFuRWxlbWVudDtcbiAgICB3b3JsZDogV29ybGQ7XG4gICAgcHJvZHVjdHM7XG4gICAgc3RhdHVzOiBzdHJpbmcgPSBcIlwiO1xuICAgIHJvdXRlOiBSb3V0ZVtdO1xuICAgIGNvc3RzPTIwO1xuICAgIGNhcGFjaXR5PTIwMDtcbiAgICBhY3RpdmVSb3V0ZSA9IDA7XG4gICAgdHlwZSA9IFwiQWlycGxhbmVcIjtcbiAgICBjb25zdHJ1Y3Rvcih3b3JsZDogV29ybGQpIHtcbiAgICAgICAgdGhpcy53b3JsZCA9IHdvcmxkO1xuICAgICAgICB0aGlzLnJvdXRlID0gW107XG4gICAgICAgIC8qICBmb3IodmFyIHg9MDt4PDQ7eCsrKXtcbiAgICAgICAgICAgICAgdmFyIHJ0PW5ldyBSb3V0ZSgpO1xuICAgICAgICAgICAgICBydC5jaXR5aWQ9eDtcbiAgICAgICAgICAgICAgdGhpcy5yb3V0ZS5wdXNoKHJ0KTtcbiAgICAgICAgICB9Ki9cbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmRvbSA9IDxhbnk+ZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKS5jcmVhdGVDb250ZXh0dWFsRnJhZ21lbnQoXCI8c3BhbiBzdHlsZT0nZm9udC1zaXplOjIwcHg7dHJhbnNmb3JtOnJvdGF0ZSgwdHVybiknIGNsYXNzPSdtZGkgbWRpLWFpcnBsYW5lJz48L3NwYW4+XCIpLmNoaWxkcmVuWzBdOy8vZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICAgIHRoaXMuZG9tLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuXG4gICAgICAgIHRoaXMuYWN0aW9uID0gXCJ3YWl0XCI7XG4gICAgICAgIHRoaXMucHJvZHVjdHMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBhbGxQcm9kdWN0cy5sZW5ndGg7IHgrKykge1xuICAgICAgICAgICAgdGhpcy5wcm9kdWN0c1t4XSA9IDA7XG5cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRvbS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICBfdGhpcy5vbmNsaWNrKGV2KTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxhc3RVcGRhdGUgPSB0aGlzLndvcmxkLmdhbWUuZGF0ZS5nZXRUaW1lKCk7XG4gICAgICAgIHRoaXMudXBkYXRlKCk7XG5cbiAgICB9XG5cbiAgICBmbHlUbyhjaXR5OiBDaXR5KSB7XG4gICAgICAgIHZhciB4ID0gY2l0eS54O1xuICAgICAgICB2YXIgeSA9IGNpdHkueTtcblxuICAgICAgICB0aGlzLmxhc3RVcGRhdGUgPSB0aGlzLndvcmxkLmdhbWUuZGF0ZS5nZXRUaW1lKCk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZmx5IHRvIFwiICsgY2l0eS5uYW1lKVxuICAgICAgICB0aGlzLmFjdGlvbiA9IFwiZmx5XCI7XG4gICAgICAgIHRoaXMuc3RhdHVzID0gXCJmbHkgdG8gXCIgKyBjaXR5Lm5hbWU7XG4gICAgICAgIHRoaXMudGFyZ2V0WCA9IHg7XG4gICAgICAgIHRoaXMudGFyZ2V0WSA9IHk7XG4gICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy53b3JsZC5jaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBwb3MgPSB0aGlzLndvcmxkLmNpdGllc1tpXS5haXJwbGFuZXNJbkNpdHkuaW5kZXhPZih0aGlzKTtcbiAgICAgICAgICAgIGlmIChwb3MgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy53b3JsZC5jaXRpZXNbaV0uYWlycGxhbmVzSW5DaXR5LnNwbGljZShwb3MsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHNlbGVjdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZG9tKVxuICAgICAgICAgICAgdGhpcy5kb20uc3R5bGUuY29sb3IgPSBcInJlZFwiO1xuICAgIH1cbiAgICB1bnNlbGVjdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZG9tKVxuICAgICAgICAgICAgdGhpcy5kb20uc3R5bGUuY29sb3IgPSBcImJsYWNrXCI7XG4gICAgfVxuICAgIGFycml2ZWQoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwidGFyZ2V0IGFycml2ZWRcIik7XG4gICAgICAgIHRoaXMudGFyZ2V0WCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy50YXJnZXRZID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFjdGlvbiA9IFwid2FpdFwiO1xuICAgICAgICB0aGlzLnN0YXR1cyA9IFwiXCI7XG4gICAgICAgIHRoaXMud29ybGQuZmluZENpdHlBdCh0aGlzLngsIHRoaXMueSk/LmFpcnBsYW5lc0luQ2l0eS5wdXNoKHRoaXMpO1xuICAgICAgICB0aGlzLmRvbS5zdHlsZS50cmFuc2Zvcm0gPSBcInJvdGF0ZSgwZGVnKVwiO1xuICAgICAgICBpZiAodGhpcy5hY3RpdmVSb3V0ZSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidW5sb2FkIG5vd1wiKTtcbiAgICAgICAgICAgIHRoaXMuYWN0aW9uID0gXCJ1bmxvYWRcIjtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gXCJ1bmxvYWRcIjtcbiAgICAgICAgICAgIHRoaXMubGFzdEFjdGlvbiA9IHRoaXMubGFzdFVwZGF0ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYWxjTmV3UG9zaXRpb24oKSB7XG4gICAgICAgIHZhciBwaXhlbFRvVGFyZ2V0ID0gTWF0aC5yb3VuZChNYXRoLnNxcnQoTWF0aC5wb3codGhpcy50YXJnZXRYIC0gdGhpcy54LCAyKSArIE1hdGgucG93KHRoaXMudGFyZ2V0WSAtIHRoaXMueSwgMikpKTsvL1B5dGhhcm9yYXNcbiAgICAgICAgdmFyIGZyb21YID0gdGhpcy54O1xuICAgICAgICB2YXIgZnJvbVkgPSB0aGlzLnk7XG4gICAgICAgIHZhciBmcm9tVGltZSA9IDA7XG4gICAgICAgIHZhciB0b1ggPSB0aGlzLnRhcmdldFg7XG4gICAgICAgIHZhciB0b1kgPSB0aGlzLnRhcmdldFk7XG4gICAgICAgIHZhciB0b1RpbWUgPSBwaXhlbFRvVGFyZ2V0IC8gdGhpcy5zcGVlZDsgICAgLy90PXMvdjsgaW4gVGFnZVxuICAgICAgICB2YXIgc3BlZWRWZWN0b3JYID0gdG9YIC0gZnJvbVg7XG4gICAgICAgIHZhciBzcGVlZFZlY3RvclkgPSB0b1kgLSBmcm9tWTtcbiAgICAgICAgdmFyIHNwZWVkVmVjdG9yVGltZSA9ICh0b1RpbWUgLSBmcm9tVGltZSk7XG4gICAgICAgIHZhciBub3dUaW1lID0gKHRoaXMud29ybGQuZ2FtZS5kYXRlLmdldFRpbWUoKSAtIHRoaXMubGFzdFVwZGF0ZSkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCk7XG4gICAgICAgIHZhciBub3dYID0gTWF0aC5yb3VuZCgobm93VGltZSAvIHNwZWVkVmVjdG9yVGltZSkgKiBzcGVlZFZlY3RvclggKyBmcm9tWCk7XG4gICAgICAgIHZhciBub3dZID0gTWF0aC5yb3VuZCgobm93VGltZSAvIHNwZWVkVmVjdG9yVGltZSkgKiBzcGVlZFZlY3RvclkgKyBmcm9tWSk7XG4gICAgICAgIGlmIChub3dUaW1lID49IHRvVGltZSkge1xuICAgICAgICAgICAgdGhpcy54ID0gdGhpcy50YXJnZXRYO1xuICAgICAgICAgICAgdGhpcy55ID0gdGhpcy50YXJnZXRZO1xuICAgICAgICAgICAgdGhpcy5hcnJpdmVkKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgcmFkID0gTWF0aC5hdGFuKChmcm9tWCAtIHRvWCkgLyAoZnJvbVkgLSB0b1kpKTtcbiAgICAgICAgICAgIHZhciB3aW5rZWwgPSAwO1xuICAgICAgICAgICAgaWYgKGZyb21ZID4gdG9ZKSB7XG4gICAgICAgICAgICAgICAgd2lua2VsID0gMzYwIC0gcmFkICogKDE4MCkgLyBNYXRoLlBJO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB3aW5rZWwgPSAxODAgLSByYWQgKiAoMTgwKSAvIE1hdGguUEk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcyA9IChcIlwiICsgd2lua2VsKS5yZXBsYWNlKFwiLFwiLCBcIi5cIik7XG4gICAgICAgICAgICB0aGlzLmRvbS5zdHlsZS50cmFuc2Zvcm0gPSBcInJvdGF0ZShcIiArIHMgKyBcImRlZylcIjtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHBpeGVsVG9UYXJnZXQrXCIgcGl4ZWwgaW4gXCIrdG9UaW1lK1wiIHNlY29uZHMuIFBvc2l0aW9uIFwiK25vd1grXCIgXCIrbm93WStcIiBsYXN0dXBkYXRlIFwiK25vd1RpbWUrXCIgXCIrd2lua2VsK1wiwrBcIik7XG4gICAgICAgICAgICB0aGlzLnggPSBub3dYO1xuICAgICAgICAgICAgdGhpcy55ID0gbm93WTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGUoKSB7XG5cbiAgICAgICAgaWYgKHRoaXMudGFyZ2V0WCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmNhbGNOZXdQb3NpdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGFzdFVwZGF0ZSA9IHRoaXMud29ybGQuZ2FtZS5kYXRlLmdldFRpbWUoKTtcbiAgICAgICAgdGhpcy5kb20uc3R5bGUudG9wID0gdGhpcy55ICsgXCJweFwiO1xuICAgICAgICB0aGlzLmRvbS5zdHlsZS5sZWZ0ID0gKHRoaXMueCAtIDE1KSArIFwicHhcIjtcbiAgICAgICAgaWYgKHRoaXMuYWN0aXZlUm91dGUgIT09IC0xICYmIHRoaXMucm91dGUubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aW9uID09PSBcInVubG9hZFwiICYmICh0aGlzLmxhc3RVcGRhdGUgLSB0aGlzLmxhc3RBY3Rpb24pID4gKDMgKiAxMDAwICogNjAgKiA2MCkpIHtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImxvYWQgbm93XCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuYWN0aW9uID0gXCJsb2FkXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBcImxvYWRcIjtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RBY3Rpb24gPSB0aGlzLmxhc3RVcGRhdGU7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3V0ZVt0aGlzLmFjdGl2ZVJvdXRlXS51bmxvYWQoKTtcbiAgICAgICAgICAgICAgICBBaXJwbGFuZURpYWxvZy5nZXRJbnN0YW5jZSgpLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aW9uID09PSBcImxvYWRcIiAmJiAodGhpcy5sYXN0VXBkYXRlIC0gdGhpcy5sYXN0QWN0aW9uKSA+ICgzICogMTAwMCAqIDYwICogNjApKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RBY3Rpb24gPSB0aGlzLmxhc3RVcGRhdGU7XG4gICAgICAgICAgICAgICAgdGhpcy5yb3V0ZVt0aGlzLmFjdGl2ZVJvdXRlXS5sb2FkKCk7XG4gICAgICAgICAgICAgICAgQWlycGxhbmVEaWFsb2cuZ2V0SW5zdGFuY2UoKS51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVJvdXRlKys7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlUm91dGUgPT09IHRoaXMucm91dGUubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVJvdXRlID0gMDtcbiAgICAgICAgICAgICAgICB2YXIgY2l0eSA9IHRoaXMud29ybGQuY2l0aWVzW3RoaXMucm91dGVbdGhpcy5hY3RpdmVSb3V0ZV0uY2l0eWlkXTtcbiAgICAgICAgICAgICAgICB0aGlzLmZseVRvKGNpdHkpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25jbGljayh0aDogTW91c2VFdmVudCkge1xuICAgICAgICB0aC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5uYW1lKTtcbiAgICAgICAgdGhpcy53b3JsZC5zZWxlY3Rpb24/LnVuc2VsZWN0KCk7XG4gICAgICAgIHRoaXMud29ybGQuc2VsZWN0aW9uID0gdGhpcztcbiAgICAgICAgdGhpcy5zZWxlY3QoKTtcbiAgICAgICAgdmFyIGggPSBBaXJwbGFuZURpYWxvZy5nZXRJbnN0YW5jZSgpO1xuICAgICAgICBoLmFpcnBsYW5lID0gdGhpcztcbiAgICAgICAgaC5zaG93KCk7XG5cbiAgICB9XG59XG52YXIgYWxsQWlycGxhbmVUeXBlcz1bXG57dHlwZWlkOjEsbW9kZWw6XCJBaXJwbGFuZSBBXCIsc3BlZWQ6MTAwLGNhcGFjaXR5OjIwMCwgY29zdHM6MjAsYnVpbGREYXlzOjI1LGJ1aWxkaW5nQ29zdHM6MTEwMDAsYnVpbGRpbmdNYXRlcmlhbDpbNDAsMCwwLDEwLDAsMCwwLDAsMTAsMCwxMCwwLDAsMCwwLDEwXX0sXG57dHlwZWlkOjIsbW9kZWw6XCJBaXJwbGFuZSBCXCIsc3BlZWQ6MTIwLGNhcGFjaXR5OjMwMCwgY29zdHM6MzAsYnVpbGREYXlzOjMwLGJ1aWxkaW5nQ29zdHM6MjEwMDAsYnVpbGRpbmdNYXRlcmlhbDpbNjAsMCwwLDIwLDAsMCwwLDAsMjAsMCwyMCwwLDAsMCwwLDIwXX0sXG57dHlwZWlkOjMsbW9kZWw6XCJBaXJwbGFuZSBDXCIsc3BlZWQ6MTAwLGNhcGFjaXR5OjUwMCwgY29zdHM6NTAsYnVpbGREYXlzOjM5LGJ1aWxkaW5nQ29zdHM6MzIwMDAsYnVpbGRpbmdNYXRlcmlhbDpbMTAwLDAsMCwzMCwwLDAsMCwwLDMwLDAsMzAsMCwwLDAsMCwzMF19LFxue3R5cGVpZDo0LG1vZGVsOlwiQWlycGxhbmUgRFwiLHNwZWVkOjExMCxjYXBhY2l0eTo2NTAsIGNvc3RzOjY1LGJ1aWxkRGF5czo0NSxidWlsZGluZ0Nvc3RzOjU1MDAwLGJ1aWxkaW5nTWF0ZXJpYWw6WzEyMCwwLDAsNDAsMCwwLDAsMCw0MCwwLDQwLDAsMCwwLDAsNDBdfSxcbnt0eXBlaWQ6NSxtb2RlbDpcIkFpcnBsYW5lIEVcIixzcGVlZDoxMDAsY2FwYWNpdHk6MTAwMCwgY29zdHM6MTAwLGJ1aWxkRGF5czo1NixidWlsZGluZ0Nvc3RzOjEwOTAwMCxidWlsZGluZ01hdGVyaWFsOlsyMDAsMCwwLDUwLDAsMCwwLDAsNTAsMCw1MCwwLDAsMCwwLDUwXX0sXG57dHlwZWlkOjYsbW9kZWw6XCJBaXJwbGFuZSBGXCIsc3BlZWQ6MTMwLGNhcGFjaXR5OjIwMDAsIGNvc3RzOjIwMCxidWlsZERheXM6NzksYnVpbGRpbmdDb3N0czoxMTAwMDAsYnVpbGRpbmdNYXRlcmlhbDpbNDAwLDAsMCwxMDAsMCwwLDAsMCwxMDAsMCwxMDAsMCwwLDAsMCwxMDBdfVxuXTtcbmV4cG9ydHthbGxBaXJwbGFuZVR5cGVzfTtcbi8vPHNwYW4gc3R5bGU9J2ZvbnQtc2l6ZToxMDBweDsnPiYjOTk1MTs8L3NwYW4+Il19