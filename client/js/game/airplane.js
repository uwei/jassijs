define(["require", "exports", "game/product", "game/airplanedialog"], function (require, exports, product_1, airplanedialog_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.allAirplaneTypes = exports.Airplane = void 0;
    function getRandomInt(max) {
        return Math.floor(Math.random() * max);
    }
    //
    class Airplane {
        constructor(world) {
            this.status = "";
            this.loadedCount = 0;
            this.activeRoute = 0;
            this.squadron = []; //Geschwader
            this.type = "Airplane";
            this.world = world;
            this.route = [];
            this.products = [];
            for (var x = 0; x < product_1.allProducts.length; x++) {
                this.products[x] = 0;
            }
            this.typeid = 1;
            /*  for(var x=0;x<4;x++){
                  var rt=new Route();
                  rt.cityid=x;
                  this.route.push(rt);
              }*/
        }
        getCurrentCity() {
            var apid = this.world.airplanes.indexOf(this);
            for (var x = 0; x < this.world.cities.length; x++) {
                if (this.world.cities[x].airplanesInCity.indexOf(apid) > -1) {
                    return this.world.cities[x];
                }
            }
            return undefined;
        }
        updateSquadron() {
            var speed = allAirplaneTypes[this.typeid].speed;
            var capacity = allAirplaneTypes[this.typeid].capacity;
            for (var x = 0; x < this.squadron.length; x++) {
                speed = Math.min(this.squadron[x].speed, speed);
                capacity += this.squadron[x].capacity;
            }
            this.speed = speed;
            this.capacity = capacity;
        }
        render() {
            var _this = this;
            this.dom = document.createRange().createContextualFragment("<span style='font-size:20px;transform:rotate(0turn)' class='mdi mdi-airplane'></span>").children[0]; //document.createElement("span");
            this.dom.style.position = "absolute";
            this.action = "wait";
            this.dom.addEventListener("click", (ev) => {
                _this.onclick(ev);
                return undefined;
            });
            this.lastUpdate = this.world.game.date.getTime();
            this.update();
        }
        refreshLoadedCount() {
            var all = 0;
            for (var x = 0; x < product_1.allProducts.length; x++) {
                all += this.products[x];
            }
            this.loadedCount = all;
        }
        flyTo(city) {
            var x = city.x;
            var y = city.y;
            this.lastUpdate = this.world.game.date.getTime();
            // console.log("fly to " + city.name)
            this.action = "fly";
            this.status = "fly to " + city.name;
            this.targetX = x;
            this.targetY = y;
            this.update();
            for (var i = 0; i < this.world.cities.length; i++) {
                var pos = this.world.cities[i].airplanesInCity.indexOf(this.world.airplanes.indexOf(this));
                if (pos !== -1) {
                    this.world.cities[i].airplanesInCity.splice(pos, 1);
                }
            }
        }
        select() {
            if (this.dom)
                this.dom.style.color = "red";
        }
        unselect() {
            if (this.dom)
                this.dom.style.color = "black";
        }
        arrived() {
            var _a;
            console.log("target arrived");
            this.targetX = undefined;
            this.targetY = undefined;
            this.action = "wait";
            this.status = "";
            (_a = this.world.findCityAt(this.x, this.y)) === null || _a === void 0 ? void 0 : _a.airplanesInCity.push(this.world.airplanes.indexOf(this));
            this.dom.style.transform = "rotate(0deg)";
            if (this.activeRoute !== -1) {
                console.log("unload now");
                this.action = "unload";
                this.status = "unload";
                this.lastAction = this.lastUpdate;
            }
        }
        calcNewPosition() {
            var pixelToTarget = Math.round(Math.sqrt(Math.pow(this.targetX - this.x, 2) + Math.pow(this.targetY - this.y, 2))); //Pytharoras
            var fromX = this.x;
            var fromY = this.y;
            var fromTime = 0;
            var toX = this.targetX;
            var toY = this.targetY;
            var toTime = pixelToTarget / this.speed; //t=s/v; in Tage
            var speedVectorX = toX - fromX;
            var speedVectorY = toY - fromY;
            var speedVectorTime = (toTime - fromTime);
            var nowTime = (this.world.game.date.getTime() - this.lastUpdate) / (1000 * 60 * 60 * 24);
            var nowX = Math.round((nowTime / speedVectorTime) * speedVectorX + fromX);
            var nowY = Math.round((nowTime / speedVectorTime) * speedVectorY + fromY);
            if (nowTime >= toTime) {
                this.x = this.targetX;
                this.y = this.targetY;
                this.arrived();
            }
            else {
                var rad = Math.atan((fromX - toX) / (fromY - toY));
                var winkel = 0;
                if (fromY > toY) {
                    winkel = 360 - rad * (180) / Math.PI;
                }
                else {
                    winkel = 180 - rad * (180) / Math.PI;
                }
                var s = ("" + winkel).replace(",", ".");
                this.dom.style.transform = "rotate(" + s + "deg)";
                // console.log(pixelToTarget+" pixel in "+toTime+" seconds. Position "+nowX+" "+nowY+" lastupdate "+nowTime+" "+winkel+"Â°");
                this.x = nowX;
                this.y = nowY;
            }
        }
        update() {
            if (this.targetX !== undefined) {
                this.calcNewPosition();
            }
            this.lastUpdate = this.world.game.date.getTime();
            this.dom.style.top = this.y + "px";
            this.dom.style.left = (this.x - 15) + "px";
            if (this.activeRoute !== -1 && this.route.length > 1) {
                if (this.action === "unload" && (this.lastUpdate - this.lastAction) > (3 * 1000 * 60 * 60)) {
                    // console.log("load now");
                    this.action = "load";
                    this.status = "load";
                    this.lastAction = this.lastUpdate;
                    if (this.activeRoute >= this.route.length) {
                        this.activeRoute = 0;
                    }
                    else
                        this.route[this.activeRoute].unload();
                    airplanedialog_1.AirplaneDialog.getInstance().update();
                }
                if (this.action === "load" && (this.lastUpdate - this.lastAction) > (3 * 1000 * 60 * 60)) {
                    this.lastAction = this.lastUpdate;
                    if (this.activeRoute >= this.route.length)
                        this.activeRoute = 0;
                    else
                        this.route[this.activeRoute].load();
                    airplanedialog_1.AirplaneDialog.getInstance().update();
                    this.activeRoute++;
                    if (this.activeRoute >= this.route.length)
                        this.activeRoute = 0;
                    var city = this.world.cities[this.route[this.activeRoute].cityid];
                    this.flyTo(city);
                }
            }
        }
        onclick(th) {
            var _a;
            th.preventDefault();
            th.stopPropagation();
            console.log(this.name);
            (_a = this.world.selection) === null || _a === void 0 ? void 0 : _a.unselect();
            this.world.selection = this;
            this.select();
            var h = airplanedialog_1.AirplaneDialog.getInstance();
            h.airplane = this;
            h.show();
        }
    }
    exports.Airplane = Airplane;
    var allAirplaneTypes = [
        { typeid: 0, model: "Airplane A", speed: 200, capacity: 200, costs: 20, buildDays: 25, buildingCosts: 11000, buildingMaterial: [40, 0, 0, 10, 0, 0, 0, 0, 10, 0, 10, 0, 0, 0, 0, 10] },
        { typeid: 1, model: "Airplane B", speed: 210, capacity: 300, costs: 30, buildDays: 30, buildingCosts: 21000, buildingMaterial: [60, 0, 0, 20, 0, 0, 0, 0, 20, 0, 20, 0, 0, 0, 0, 20] },
        { typeid: 2, model: "Airplane C", speed: 220, capacity: 500, costs: 50, buildDays: 39, buildingCosts: 32000, buildingMaterial: [100, 0, 0, 30, 0, 0, 0, 0, 30, 0, 30, 0, 0, 0, 0, 30] },
        { typeid: 3, model: "Airplane D", speed: 240, capacity: 650, costs: 65, buildDays: 45, buildingCosts: 55000, buildingMaterial: [120, 0, 0, 40, 0, 0, 0, 0, 40, 0, 40, 0, 0, 0, 0, 40] },
        { typeid: 4, model: "Airplane E", speed: 260, capacity: 1000, costs: 100, buildDays: 56, buildingCosts: 109000, buildingMaterial: [200, 0, 0, 50, 0, 0, 0, 0, 50, 0, 50, 0, 0, 0, 0, 50] },
        { typeid: 5, model: "Airplane F", speed: 280, capacity: 2000, costs: 200, buildDays: 79, buildingCosts: 110000, buildingMaterial: [400, 0, 0, 100, 0, 0, 0, 0, 100, 0, 100, 0, 0, 0, 0, 100] }
    ];
    exports.allAirplaneTypes = allAirplaneTypes;
});
//<span style='font-size:100px;'>&#9951;</span>
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWlycGxhbmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9nYW1lL2FpcnBsYW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7SUFNQSxTQUFTLFlBQVksQ0FBQyxHQUFHO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUNELEVBQUU7SUFDRixNQUFhLFFBQVE7UUF1QmpCLFlBQVksS0FBWTtZQVJ4QixXQUFNLEdBQVcsRUFBRSxDQUFDO1lBSXBCLGdCQUFXLEdBQVEsQ0FBQyxDQUFDO1lBQ3JCLGdCQUFXLEdBQUcsQ0FBQyxDQUFDO1lBQ2hCLGFBQVEsR0FBWSxFQUFFLENBQUMsQ0FBQSxZQUFZO1lBQ25DLFNBQUksR0FBRyxVQUFVLENBQUM7WUFFZCxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztZQUNuQixJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO1lBQ2xCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxxQkFBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDM0MsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7YUFFeEI7WUFDRCxJQUFJLENBQUMsTUFBTSxHQUFDLENBQUMsQ0FBQztZQUNkOzs7O2lCQUlLO1FBQ1QsQ0FBQztRQUNELGNBQWM7WUFDVixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDOUMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtn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QUFDLENBQUMsRUFBQyxFQUFFLENBQUMsRUFBQztRQUN2SixFQUFDLE1BQU0sRUFBQyxDQUFDLEVBQUMsS0FBSyxFQUFDLFlBQVksRUFBQyxLQUFLLEVBQUMsR0FBRyxFQUFDLFFBQVEsRUFBQyxHQUFHLEVBQUUsS0FBSyxFQUFDLEVBQUUsRUFBQyxTQUFTLEVBQUMsRUFBRSxFQUFDLGFBQWEsRUFBQyxLQUFLLEVBQUMsZ0JBQWdCLEVBQUMsQ0FBQyxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFFLENBQUMsRUFBQztRQUN2SixFQUFDLE1BQU0sRUFBQyxDQUFDLEVBQUMsS0FBSyxFQUFDLFlBQVksRUFBQyxLQUFLLEVBQUMsR0FBRyxFQUFDLFFBQVEsRUFBQyxHQUFHLEVBQUUsS0FBSyxFQUFDLEVBQUUsRUFBQyxTQUFTLEVBQUMsRUFBRSxFQUFDLGFBQWEsRUFBQyxLQUFLLEVBQUMsZ0JBQWdCLEVBQUMsQ0FBQyxHQUFHLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFFLENBQUMsRUFBQztRQUN4SixFQUFDLE1BQU0sRUFBQyxDQUFDLEVBQUMsS0FBSyxFQUFDLFlBQVksRUFBQyxLQUFLLEVBQUMsR0FBRyxFQUFDLFFBQVEsRUFBQyxHQUFHLEVBQUUsS0FBSyxFQUFDLEVBQUUsRUFBQyxTQUFTLEVBQUMsRUFBRSxFQUFDLGFBQWEsRUFBQyxLQUFLLEVBQUMsZ0JBQWdCLEVBQUMsQ0FBQyxHQUFHLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFFLENBQUMsRUFBQztRQUN4SixFQUFDLE1BQU0sRUFBQyxDQUFDLEVBQUMsS0FBSyxFQUFDLFlBQVksRUFBQyxLQUFLLEVBQUMsR0FBRyxFQUFDLFFBQVEsRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLEdBQUcsRUFBQyxTQUFTLEVBQUMsRUFBRSxFQUFDLGFBQWEsRUFBQyxNQUFNLEVBQUMsZ0JBQWdCLEVBQUMsQ0FBQyxHQUFHLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFFLENBQUMsRUFBQztRQUMzSixFQUFDLE1BQU0sRUFBQyxDQUFDLEVBQUMsS0FBSyxFQUFDLFlBQVksRUFBQyxLQUFLLEVBQUMsR0FBRyxFQUFDLFFBQVEsRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLEdBQUcsRUFBQyxTQUFTLEVBQUMsRUFBRSxFQUFDLGFBQWEsRUFBQyxNQUFNLEVBQUMsZ0JBQWdCLEVBQUMsQ0FBQyxHQUFHLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxHQUFHLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEdBQUcsRUFBQyxDQUFDLEVBQUMsR0FBRyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxHQUFHLENBQUMsRUFBQztLQUM5SixDQUFDO0lBQ0ssNENBQWdCOztBQUN2QiwrQ0FBK0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBXb3JsZCB9IGZyb20gXCJnYW1lL3dvcmxkXCI7XG5pbXBvcnQgeyBhbGxQcm9kdWN0cyB9IGZyb20gXCJnYW1lL3Byb2R1Y3RcIjtcbmltcG9ydCB7IEFpcnBsYW5lRGlhbG9nIH0gZnJvbSBcImdhbWUvYWlycGxhbmVkaWFsb2dcIjtcbmltcG9ydCB7IFJvdXRlIH0gZnJvbSBcImdhbWUvcm91dGVcIjtcbmltcG9ydCB7IENpdHkgfSBmcm9tIFwiZ2FtZS9jaXR5XCI7XG5cbmZ1bmN0aW9uIGdldFJhbmRvbUludChtYXgpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbWF4KTtcbn1cbi8vXG5leHBvcnQgY2xhc3MgQWlycGxhbmUge1xuICAgIHR5cGVpZDpudW1iZXI7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGFjdGlvbjogc3RyaW5nO1xuICAgIGxhc3RBY3Rpb246IG51bWJlcjtcbiAgICB4OiBudW1iZXI7XG4gICAgeTogbnVtYmVyO1xuICAgIC8vcGl4ZWwgcHJvIHNlY29uZFxuICAgIHNwZWVkOiBudW1iZXI7XG4gICAgbGFzdFVwZGF0ZTogbnVtYmVyO1xuICAgIHRhcmdldFg6IG51bWJlcjtcbiAgICB0YXJnZXRZOiBudW1iZXI7XG4gICAgZG9tOiBIVE1MU3BhbkVsZW1lbnQ7XG4gICAgd29ybGQ6IFdvcmxkO1xuICAgIHByb2R1Y3RzO1xuICAgIHN0YXR1czogc3RyaW5nID0gXCJcIjtcbiAgICByb3V0ZTogUm91dGVbXTtcbiAgICBjb3N0czpudW1iZXI7XG4gICAgY2FwYWNpdHk6bnVtYmVyO1xuICAgIGxvYWRlZENvdW50Om51bWJlcj0wO1xuICAgIGFjdGl2ZVJvdXRlID0gMDtcbiAgICBzcXVhZHJvbjpBaXJwbGFuZVtdPVtdOy8vR2VzY2h3YWRlclxuICAgIHR5cGUgPSBcIkFpcnBsYW5lXCI7XG4gICAgY29uc3RydWN0b3Iod29ybGQ6IFdvcmxkKSB7XG4gICAgICAgIHRoaXMud29ybGQgPSB3b3JsZDtcbiAgICAgICAgdGhpcy5yb3V0ZSA9IFtdO1xuICAgICAgICAgdGhpcy5wcm9kdWN0cyA9IFtdO1xuICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgYWxsUHJvZHVjdHMubGVuZ3RoOyB4KyspIHtcbiAgICAgICAgICAgIHRoaXMucHJvZHVjdHNbeF0gPSAwO1xuXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50eXBlaWQ9MTtcbiAgICAgICAgLyogIGZvcih2YXIgeD0wO3g8NDt4Kyspe1xuICAgICAgICAgICAgICB2YXIgcnQ9bmV3IFJvdXRlKCk7XG4gICAgICAgICAgICAgIHJ0LmNpdHlpZD14O1xuICAgICAgICAgICAgICB0aGlzLnJvdXRlLnB1c2gocnQpO1xuICAgICAgICAgIH0qL1xuICAgIH1cbiAgICBnZXRDdXJyZW50Q2l0eSgpe1xuICAgICAgICB2YXIgYXBpZCA9IHRoaXMud29ybGQuYWlycGxhbmVzLmluZGV4T2YodGhpcyk7XG4gICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy53b3JsZC5jaXRpZXMubGVuZ3RoOyB4KyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLndvcmxkLmNpdGllc1t4XS5haXJwbGFuZXNJbkNpdHkuaW5kZXhPZihhcGlkKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMud29ybGQuY2l0aWVzW3hdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHVwZGF0ZVNxdWFkcm9uKCl7XG4gICAgICAgIHZhciBzcGVlZD1hbGxBaXJwbGFuZVR5cGVzW3RoaXMudHlwZWlkXS5zcGVlZDtcbiAgICAgICAgdmFyIGNhcGFjaXR5PWFsbEFpcnBsYW5lVHlwZXNbdGhpcy50eXBlaWRdLmNhcGFjaXR5O1xuICAgICAgICBmb3IodmFyIHg9MDt4PHRoaXMuc3F1YWRyb24ubGVuZ3RoO3grKyl7XG4gICAgICAgICAgICBzcGVlZD1NYXRoLm1pbih0aGlzLnNxdWFkcm9uW3hdLnNwZWVkLHNwZWVkKTtcbiAgICAgICAgICAgIGNhcGFjaXR5Kz10aGlzLnNxdWFkcm9uW3hdLmNhcGFjaXR5O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3BlZWQ9c3BlZWQ7XG4gICAgICAgIHRoaXMuY2FwYWNpdHk9Y2FwYWNpdHk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5kb20gPSA8YW55PmRvY3VtZW50LmNyZWF0ZVJhbmdlKCkuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KFwiPHNwYW4gc3R5bGU9J2ZvbnQtc2l6ZToyMHB4O3RyYW5zZm9ybTpyb3RhdGUoMHR1cm4pJyBjbGFzcz0nbWRpIG1kaS1haXJwbGFuZSc+PC9zcGFuPlwiKS5jaGlsZHJlblswXTsvL2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgICB0aGlzLmRvbS5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcblxuICAgICAgICB0aGlzLmFjdGlvbiA9IFwid2FpdFwiO1xuICAgICAgIFxuICAgICAgIFxuICAgICAgICB0aGlzLmRvbS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICBfdGhpcy5vbmNsaWNrKGV2KTtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxhc3RVcGRhdGUgPSB0aGlzLndvcmxkLmdhbWUuZGF0ZS5nZXRUaW1lKCk7XG4gICAgICAgIHRoaXMudXBkYXRlKCk7XG5cbiAgICB9XG4gICAgcmVmcmVzaExvYWRlZENvdW50KCl7XG4gICAgICAgIHZhciBhbGw9MDtcbiAgICAgICAgZm9yKHZhciB4PTA7eDxhbGxQcm9kdWN0cy5sZW5ndGg7eCsrKXtcbiAgICAgICAgICAgIGFsbCs9dGhpcy5wcm9kdWN0c1t4XTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvYWRlZENvdW50PWFsbDtcbiAgICB9XG4gICAgZmx5VG8oY2l0eTogQ2l0eSkge1xuICAgICAgICB2YXIgeCA9IGNpdHkueDtcbiAgICAgICAgdmFyIHkgPSBjaXR5Lnk7XG5cbiAgICAgICAgdGhpcy5sYXN0VXBkYXRlID0gdGhpcy53b3JsZC5nYW1lLmRhdGUuZ2V0VGltZSgpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcImZseSB0byBcIiArIGNpdHkubmFtZSlcbiAgICAgICAgdGhpcy5hY3Rpb24gPSBcImZseVwiO1xuICAgICAgICB0aGlzLnN0YXR1cyA9IFwiZmx5IHRvIFwiICsgY2l0eS5uYW1lO1xuICAgICAgICB0aGlzLnRhcmdldFggPSB4O1xuICAgICAgICB0aGlzLnRhcmdldFkgPSB5O1xuICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMud29ybGQuY2l0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgcG9zID0gdGhpcy53b3JsZC5jaXRpZXNbaV0uYWlycGxhbmVzSW5DaXR5LmluZGV4T2YodGhpcy53b3JsZC5haXJwbGFuZXMuaW5kZXhPZih0aGlzKSk7IFxuICAgICAgICAgICAgaWYgKHBvcyAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLndvcmxkLmNpdGllc1tpXS5haXJwbGFuZXNJbkNpdHkuc3BsaWNlKHBvcywgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2VsZWN0KCkge1xuICAgICAgICBpZiAodGhpcy5kb20pXG4gICAgICAgICAgICB0aGlzLmRvbS5zdHlsZS5jb2xvciA9IFwicmVkXCI7XG4gICAgfVxuICAgIHVuc2VsZWN0KCkge1xuICAgICAgICBpZiAodGhpcy5kb20pXG4gICAgICAgICAgICB0aGlzLmRvbS5zdHlsZS5jb2xvciA9IFwiYmxhY2tcIjtcbiAgICB9XG4gICAgYXJyaXZlZCgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJ0YXJnZXQgYXJyaXZlZFwiKTtcbiAgICAgICAgdGhpcy50YXJnZXRYID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnRhcmdldFkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYWN0aW9uID0gXCJ3YWl0XCI7XG4gICAgICAgIHRoaXMuc3RhdHVzID0gXCJcIjtcbiAgICAgICAgdGhpcy53b3JsZC5maW5kQ2l0eUF0KHRoaXMueCwgdGhpcy55KT8uYWlycGxhbmVzSW5DaXR5LnB1c2godGhpcy53b3JsZC5haXJwbGFuZXMuaW5kZXhPZih0aGlzKSk7XG4gICAgICAgIHRoaXMuZG9tLnN0eWxlLnRyYW5zZm9ybSA9IFwicm90YXRlKDBkZWcpXCI7XG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZVJvdXRlICE9PSAtMSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJ1bmxvYWQgbm93XCIpO1xuICAgICAgICAgICAgdGhpcy5hY3Rpb24gPSBcInVubG9hZFwiO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBcInVubG9hZFwiO1xuICAgICAgICAgICAgdGhpcy5sYXN0QWN0aW9uID0gdGhpcy5sYXN0VXBkYXRlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhbGNOZXdQb3NpdGlvbigpIHtcbiAgICAgICAgdmFyIHBpeGVsVG9UYXJnZXQgPSBNYXRoLnJvdW5kKE1hdGguc3FydChNYXRoLnBvdyh0aGlzLnRhcmdldFggLSB0aGlzLngsIDIpICsgTWF0aC5wb3codGhpcy50YXJnZXRZIC0gdGhpcy55LCAyKSkpOy8vUHl0aGFyb3Jhc1xuICAgICAgICB2YXIgZnJvbVggPSB0aGlzLng7XG4gICAgICAgIHZhciBmcm9tWSA9IHRoaXMueTtcbiAgICAgICAgdmFyIGZyb21UaW1lID0gMDtcbiAgICAgICAgdmFyIHRvWCA9IHRoaXMudGFyZ2V0WDtcbiAgICAgICAgdmFyIHRvWSA9IHRoaXMudGFyZ2V0WTtcbiAgICAgICAgdmFyIHRvVGltZSA9IHBpeGVsVG9UYXJnZXQgLyB0aGlzLnNwZWVkOyAgICAvL3Q9cy92OyBpbiBUYWdlXG4gICAgICAgIHZhciBzcGVlZFZlY3RvclggPSB0b1ggLSBmcm9tWDtcbiAgICAgICAgdmFyIHNwZWVkVmVjdG9yWSA9IHRvWSAtIGZyb21ZO1xuICAgICAgICB2YXIgc3BlZWRWZWN0b3JUaW1lID0gKHRvVGltZSAtIGZyb21UaW1lKTtcbiAgICAgICAgdmFyIG5vd1RpbWUgPSAodGhpcy53b3JsZC5nYW1lLmRhdGUuZ2V0VGltZSgpIC0gdGhpcy5sYXN0VXBkYXRlKSAvICgxMDAwICogNjAgKiA2MCAqIDI0KTtcbiAgICAgICAgdmFyIG5vd1ggPSBNYXRoLnJvdW5kKChub3dUaW1lIC8gc3BlZWRWZWN0b3JUaW1lKSAqIHNwZWVkVmVjdG9yWCArIGZyb21YKTtcbiAgICAgICAgdmFyIG5vd1kgPSBNYXRoLnJvdW5kKChub3dUaW1lIC8gc3BlZWRWZWN0b3JUaW1lKSAqIHNwZWVkVmVjdG9yWSArIGZyb21ZKTtcbiAgICAgICAgaWYgKG5vd1RpbWUgPj0gdG9UaW1lKSB7XG4gICAgICAgICAgICB0aGlzLnggPSB0aGlzLnRhcmdldFg7XG4gICAgICAgICAgICB0aGlzLnkgPSB0aGlzLnRhcmdldFk7XG4gICAgICAgICAgICB0aGlzLmFycml2ZWQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciByYWQgPSBNYXRoLmF0YW4oKGZyb21YIC0gdG9YKSAvIChmcm9tWSAtIHRvWSkpO1xuICAgICAgICAgICAgdmFyIHdpbmtlbCA9IDA7XG4gICAgICAgICAgICBpZiAoZnJvbVkgPiB0b1kpIHtcbiAgICAgICAgICAgICAgICB3aW5rZWwgPSAzNjAgLSByYWQgKiAoMTgwKSAvIE1hdGguUEk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHdpbmtlbCA9IDE4MCAtIHJhZCAqICgxODApIC8gTWF0aC5QSTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzID0gKFwiXCIgKyB3aW5rZWwpLnJlcGxhY2UoXCIsXCIsIFwiLlwiKTtcbiAgICAgICAgICAgIHRoaXMuZG9tLnN0eWxlLnRyYW5zZm9ybSA9IFwicm90YXRlKFwiICsgcyArIFwiZGVnKVwiO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocGl4ZWxUb1RhcmdldCtcIiBwaXhlbCBpbiBcIit0b1RpbWUrXCIgc2Vjb25kcy4gUG9zaXRpb24gXCIrbm93WCtcIiBcIitub3dZK1wiIGxhc3R1cGRhdGUgXCIrbm93VGltZStcIiBcIit3aW5rZWwrXCLCsFwiKTtcbiAgICAgICAgICAgIHRoaXMueCA9IG5vd1g7XG4gICAgICAgICAgICB0aGlzLnkgPSBub3dZO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZSgpIHtcblxuICAgICAgICBpZiAodGhpcy50YXJnZXRYICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY2FsY05ld1Bvc2l0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYXN0VXBkYXRlID0gdGhpcy53b3JsZC5nYW1lLmRhdGUuZ2V0VGltZSgpO1xuICAgICAgICB0aGlzLmRvbS5zdHlsZS50b3AgPSB0aGlzLnkgKyBcInB4XCI7XG4gICAgICAgIHRoaXMuZG9tLnN0eWxlLmxlZnQgPSAodGhpcy54IC0gMTUpICsgXCJweFwiO1xuICAgICAgICBpZiAodGhpcy5hY3RpdmVSb3V0ZSAhPT0gLTEgJiYgdGhpcy5yb3V0ZS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hY3Rpb24gPT09IFwidW5sb2FkXCIgJiYgKHRoaXMubGFzdFVwZGF0ZSAtIHRoaXMubGFzdEFjdGlvbikgPiAoMyAqIDEwMDAgKiA2MCAqIDYwKSkge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwibG9hZCBub3dcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3Rpb24gPSBcImxvYWRcIjtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IFwibG9hZFwiO1xuICAgICAgICAgICAgICAgIHRoaXMubGFzdEFjdGlvbiA9IHRoaXMubGFzdFVwZGF0ZTtcbiAgICAgICAgICAgICAgICAgaWYodGhpcy5hY3RpdmVSb3V0ZT49dGhpcy5yb3V0ZS5sZW5ndGgpe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVJvdXRlPTA7XG4gICAgICAgICAgICAgICAgIH1lbHNlXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm91dGVbdGhpcy5hY3RpdmVSb3V0ZV0udW5sb2FkKCk7XG4gICAgICAgICAgICAgICAgQWlycGxhbmVEaWFsb2cuZ2V0SW5zdGFuY2UoKS51cGRhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmFjdGlvbiA9PT0gXCJsb2FkXCIgJiYgKHRoaXMubGFzdFVwZGF0ZSAtIHRoaXMubGFzdEFjdGlvbikgPiAoMyAqIDEwMDAgKiA2MCAqIDYwKSkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0QWN0aW9uID0gdGhpcy5sYXN0VXBkYXRlO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuYWN0aXZlUm91dGU+PXRoaXMucm91dGUubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVJvdXRlPTA7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvdXRlW3RoaXMuYWN0aXZlUm91dGVdLmxvYWQoKTtcbiAgICAgICAgICAgICAgICBBaXJwbGFuZURpYWxvZy5nZXRJbnN0YW5jZSgpLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlUm91dGUrKztcbiAgICAgICAgICAgICAgICBpZih0aGlzLmFjdGl2ZVJvdXRlPj10aGlzLnJvdXRlLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVSb3V0ZT0wO1xuICAgICAgICAgICAgICAgIHZhciBjaXR5ID0gdGhpcy53b3JsZC5jaXRpZXNbdGhpcy5yb3V0ZVt0aGlzLmFjdGl2ZVJvdXRlXS5jaXR5aWRdO1xuICAgICAgICAgICAgICAgIHRoaXMuZmx5VG8oY2l0eSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBvbmNsaWNrKHRoOiBNb3VzZUV2ZW50KSB7XG4gICAgICAgIHRoLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLm5hbWUpO1xuICAgICAgICB0aGlzLndvcmxkLnNlbGVjdGlvbj8udW5zZWxlY3QoKTtcbiAgICAgICAgdGhpcy53b3JsZC5zZWxlY3Rpb24gPSB0aGlzO1xuICAgICAgICB0aGlzLnNlbGVjdCgpO1xuICAgICAgICB2YXIgaCA9IEFpcnBsYW5lRGlhbG9nLmdldEluc3RhbmNlKCk7XG4gICAgICAgIGguYWlycGxhbmUgPSB0aGlzO1xuICAgICAgICBoLnNob3coKTtcblxuICAgIH1cbn1cbnZhciBhbGxBaXJwbGFuZVR5cGVzPVtcbnt0eXBlaWQ6MCxtb2RlbDpcIkFpcnBsYW5lIEFcIixzcGVlZDoyMDAsY2FwYWNpdHk6MjAwLCBjb3N0czoyMCxidWlsZERheXM6MjUsYnVpbGRpbmdDb3N0czoxMTAwMCxidWlsZGluZ01hdGVyaWFsOls0MCwwLDAsMTAsMCwwLDAsMCwxMCwwLDEwLDAsMCwwLDAsMTBdfSxcbnt0eXBlaWQ6MSxtb2RlbDpcIkFpcnBsYW5lIEJcIixzcGVlZDoyMTAsY2FwYWNpdHk6MzAwLCBjb3N0czozMCxidWlsZERheXM6MzAsYnVpbGRpbmdDb3N0czoyMTAwMCxidWlsZGluZ01hdGVyaWFsOls2MCwwLDAsMjAsMCwwLDAsMCwyMCwwLDIwLDAsMCwwLDAsMjBdfSxcbnt0eXBlaWQ6Mixtb2RlbDpcIkFpcnBsYW5lIENcIixzcGVlZDoyMjAsY2FwYWNpdHk6NTAwLCBjb3N0czo1MCxidWlsZERheXM6MzksYnVpbGRpbmdDb3N0czozMjAwMCxidWlsZGluZ01hdGVyaWFsOlsxMDAsMCwwLDMwLDAsMCwwLDAsMzAsMCwzMCwwLDAsMCwwLDMwXX0sXG57dHlwZWlkOjMsbW9kZWw6XCJBaXJwbGFuZSBEXCIsc3BlZWQ6MjQwLGNhcGFjaXR5OjY1MCwgY29zdHM6NjUsYnVpbGREYXlzOjQ1LGJ1aWxkaW5nQ29zdHM6NTUwMDAsYnVpbGRpbmdNYXRlcmlhbDpbMTIwLDAsMCw0MCwwLDAsMCwwLDQwLDAsNDAsMCwwLDAsMCw0MF19LFxue3R5cGVpZDo0LG1vZGVsOlwiQWlycGxhbmUgRVwiLHNwZWVkOjI2MCxjYXBhY2l0eToxMDAwLCBjb3N0czoxMDAsYnVpbGREYXlzOjU2LGJ1aWxkaW5nQ29zdHM6MTA5MDAwLGJ1aWxkaW5nTWF0ZXJpYWw6WzIwMCwwLDAsNTAsMCwwLDAsMCw1MCwwLDUwLDAsMCwwLDAsNTBdfSxcbnt0eXBlaWQ6NSxtb2RlbDpcIkFpcnBsYW5lIEZcIixzcGVlZDoyODAsY2FwYWNpdHk6MjAwMCwgY29zdHM6MjAwLGJ1aWxkRGF5czo3OSxidWlsZGluZ0Nvc3RzOjExMDAwMCxidWlsZGluZ01hdGVyaWFsOls0MDAsMCwwLDEwMCwwLDAsMCwwLDEwMCwwLDEwMCwwLDAsMCwwLDEwMF19XG5dO1xuZXhwb3J0e2FsbEFpcnBsYW5lVHlwZXN9O1xuLy88c3BhbiBzdHlsZT0nZm9udC1zaXplOjEwMHB4Oyc+JiM5OTUxOzwvc3Bhbj4iXX0=